<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ICT Labo â€” Permanenties</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --navy:   #0d1b2a;
      --navy2:  #142436;
      --navy3:  #1c3248;
      --blue:   #2e7cf6;
      --blue2:  #5b9bf8;
      --teal:   #0fb8a9;
      --amber:  #f0a500;
      --red:    #e84040;
      --green:  #22c55e;
      --snow:   #f2f6fc;
      --mist:   #e2eaf5;
      --ink:    #0d1b2a;
      --sub:    #546e8a;
      --line:   rgba(255,255,255,.08);
      --lineL:  rgba(13,27,42,.09);
      --radius: 14px;
      --sans:   'DM Sans', sans-serif;
      --mono:   'DM Mono', monospace;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--sans);
      background: var(--snow);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      overflow: hidden;
    }

    /* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sidebar {
      width: 260px;
      min-width: 260px;
      background: var(--navy);
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow-y: auto;
      position: sticky;
      top: 0;
    }

    .sidebar-logo {
      padding: 28px 24px 20px;
      border-bottom: 1px solid var(--line);
    }
    .sidebar-logo .org {
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 1.6px;
      text-transform: uppercase;
      color: var(--blue2);
      margin-bottom: 4px;
    }
    .sidebar-logo h1 {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -.3px;
      line-height: 1.25;
    }
    .sidebar-logo h1 span {
      color: var(--teal);
    }

    .sidebar-status {
      margin: 16px 20px 0;
    }
    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.6);
      border: 1px solid var(--line);
    }
    .status-pill.ok   { background: rgba(34,197,94,.15); color: #6ee7b7; border-color: rgba(34,197,94,.2); }
    .status-pill.err  { background: rgba(232,64,64,.15); color: #fca5a5; border-color: rgba(232,64,64,.2); }
    .status-pill.load { background: rgba(46,124,246,.12); color: #93c5fd; border-color: rgba(46,124,246,.2); }
    .status-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

    .sidebar-nav {
      padding: 20px 0;
      flex: 1;
    }
    .nav-label {
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 1.4px;
      text-transform: uppercase;
      color: rgba(255,255,255,.3);
      padding: 0 20px 8px;
      margin-top: 4px;
    }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      font-size: 13.5px;
      font-weight: 500;
      color: rgba(255,255,255,.55);
      cursor: pointer;
      border-radius: 0;
      transition: all .15s;
      border-left: 3px solid transparent;
      user-select: none;
    }
    .nav-item:hover { color: #fff; background: rgba(255,255,255,.06); }
    .nav-item.active { color: #fff; background: rgba(46,124,246,.18); border-left-color: var(--blue); }
    .nav-item .icon { font-size: 16px; width: 20px; text-align: center; }

    .sidebar-people {
      padding: 0 12px 20px;
      border-top: 1px solid var(--line);
      padding-top: 14px;
    }
    .people-label {
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: rgba(255,255,255,.3);
      padding: 0 8px 10px;
    }
    .person-chip {
      display: flex;
      align-items: center;
      gap: 9px;
      padding: 7px 10px;
      border-radius: 8px;
      font-size: 13px;
      color: rgba(255,255,255,.6);
      cursor: pointer;
      transition: all .12s;
    }
    .person-chip:hover { background: rgba(255,255,255,.07); color: #fff; }
    .person-chip.active { background: rgba(46,124,246,.2); color: #fff; }
    .person-chip.active .avatar { background: var(--blue); }
    .avatar {
      width: 26px; height: 26px;
      border-radius: 8px;
      background: rgba(255,255,255,.1);
      display: flex; align-items: center; justify-content: center;
      font-size: 11px;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main {
      flex: 1;
      overflow-y: auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      background: #fff;
      border-bottom: 1px solid var(--lineL);
      padding: 14px 28px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .search-wrap {
      flex: 1;
      min-width: 200px;
      position: relative;
    }
    .search-icon {
      position: absolute;
      left: 12px; top: 50%;
      transform: translateY(-50%);
      color: var(--sub);
      font-size: 14px;
      pointer-events: none;
    }
    .search-wrap input {
      width: 100%;
      padding: 10px 12px 10px 36px;
      border: 1.5px solid var(--mist);
      border-radius: 10px;
      font-family: var(--sans);
      font-size: 13.5px;
      color: var(--ink);
      background: var(--snow);
      outline: none;
      transition: border-color .15s;
    }
    .search-wrap input:focus { border-color: var(--blue); background: #fff; }
    .search-wrap input::placeholder { color: #a0aec0; }

    .tb-date {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .tb-date input[type=date] {
      padding: 9px 12px;
      border: 1.5px solid var(--mist);
      border-radius: 10px;
      font-family: var(--sans);
      font-size: 13.5px;
      color: var(--ink);
      background: var(--snow);
      outline: none;
      cursor: pointer;
      transition: border-color .15s;
    }
    .tb-date input[type=date]:focus { border-color: var(--blue); background: #fff; }

    .btn {
      padding: 9px 16px;
      border-radius: 10px;
      border: 1.5px solid var(--mist);
      background: #fff;
      font-family: var(--sans);
      font-size: 13px;
      font-weight: 600;
      color: var(--ink);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 7px;
      transition: all .12s;
      white-space: nowrap;
    }
    .btn:hover { border-color: var(--blue); color: var(--blue); background: rgba(46,124,246,.05); }
    .btn.primary {
      background: var(--blue);
      border-color: var(--blue);
      color: #fff;
    }
    .btn.primary:hover { background: #1c6ae4; }

    /* â”€â”€ CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .content {
      padding: 24px 28px 40px;
      flex: 1;
    }

    /* view panels */
    .view { display: none; }
    .view.active { display: block; }

    /* â”€â”€ TODAY CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .today-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .today-title {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -.4px;
    }
    .today-title span { color: var(--blue); }
    .today-sub { font-size: 13px; color: var(--sub); margin-top: 2px; }

    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 14px;
    }

    .team-card {
      background: #fff;
      border: 1.5px solid var(--lineL);
      border-radius: var(--radius);
      padding: 18px 16px;
      transition: all .18s;
      animation: fadeUp .3s ease both;
    }
    .team-card:hover {
      border-color: var(--blue);
      box-shadow: 0 8px 24px rgba(46,124,246,.1);
      transform: translateY(-2px);
    }
    @keyframes fadeUp {
      from { opacity:0; transform: translateY(10px); }
      to   { opacity:1; transform: translateY(0); }
    }

    .tc-top {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .tc-avatar {
      width: 38px; height: 38px;
      border-radius: 10px;
      background: var(--navy);
      color: #fff;
      display: flex; align-items: center; justify-content: center;
      font-size: 13px;
      font-weight: 700;
      flex-shrink: 0;
    }
    .tc-name { font-size: 14px; font-weight: 700; }
    .tc-codes {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    /* â”€â”€ TAGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tag {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 7px;
      font-size: 11.5px;
      font-weight: 700;
      font-family: var(--mono);
      letter-spacing: .3px;
      white-space: nowrap;
    }
    .tag.norm   { background: #edf3ff; color: #1a4ecc; border: 1px solid rgba(46,124,246,.2); }
    .tag.hotline{ background: rgba(232,64,64,.1); color: #b91c1c; border: 1px solid rgba(232,64,64,.22); }
    .tag.wacht  { background: rgba(240,165,0,.12); color: #92400e; border: 1px solid rgba(240,165,0,.28); }
    .tag.afwezig{ background: rgba(100,116,139,.1); color: #475569; border: 1px solid rgba(100,116,139,.18); }
    .tag.empty  { color: #94a3b8; font-family: var(--sans); font-weight: 400; font-size: 12px; font-style: italic; }

    /* â”€â”€ TABLE VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .table-wrap {
      background: #fff;
      border: 1.5px solid var(--lineL);
      border-radius: var(--radius);
      overflow: hidden;
    }
    .table-scroll { overflow-x: auto; max-height: 72vh; overflow-y: auto; }
    table { width: 100%; border-collapse: collapse; }
    thead th {
      text-align: left;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: .8px;
      text-transform: uppercase;
      color: var(--sub);
      padding: 12px 16px;
      border-bottom: 1.5px solid var(--lineL);
      background: var(--snow);
      position: sticky; top: 0; z-index: 2;
      white-space: nowrap;
    }
    tbody td {
      padding: 11px 16px;
      border-bottom: 1px solid rgba(13,27,42,.05);
      font-size: 13.5px;
      vertical-align: middle;
    }
    tbody tr:last-child td { border-bottom: none; }
    tbody tr { transition: background .1s; }
    tbody tr:hover { background: rgba(46,124,246,.03); }

    .td-date { font-family: var(--mono); font-size: 12.5px; color: var(--sub); white-space: nowrap; }
    .td-person { font-weight: 700; font-size: 14px; }
    .td-codes { display: flex; flex-wrap: wrap; gap: 5px; }

    .tfoot-bar {
      padding: 10px 16px;
      border-top: 1.5px solid var(--lineL);
      font-size: 12px;
      color: var(--sub);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--snow);
    }

    /* â”€â”€ WEEK VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .week-nav {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }
    .week-label {
      font-size: 16px;
      font-weight: 700;
      flex: 1;
      text-align: center;
    }

    .week-grid {
      display: grid;
      grid-template-columns: 140px repeat(5, 1fr);
      gap: 2px;
      background: var(--lineL);
      border: 1.5px solid var(--lineL);
      border-radius: var(--radius);
      overflow: hidden;
    }
    .wg-header {
      background: var(--navy);
      color: rgba(255,255,255,.8);
      font-size: 11.5px;
      font-weight: 600;
      padding: 10px 12px;
      text-align: center;
    }
    .wg-header.day-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1px;
    }
    .wg-header.day-col .day-name { font-size: 10px; text-transform: uppercase; letter-spacing: .8px; color: rgba(255,255,255,.5); }
    .wg-header.day-col .day-num  { font-size: 16px; font-weight: 700; color: #fff; }
    .wg-header.day-col.today-col { background: var(--blue); }
    .wg-header.day-col.today-col .day-name { color: rgba(255,255,255,.75); }

    .wg-person {
      background: var(--navy2);
      color: rgba(255,255,255,.85);
      font-size: 12px;
      font-weight: 600;
      padding: 10px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .wg-cell {
      background: #fff;
      padding: 8px 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 3px;
      align-items: flex-start;
      min-height: 46px;
    }
    .wg-cell.today-col { background: rgba(46,124,246,.04); }

    /* â”€â”€ EMPTY STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty-state {
      padding: 60px 20px;
      text-align: center;
      color: var(--sub);
    }
    .empty-state .icon { font-size: 40px; margin-bottom: 12px; }
    .empty-state p { font-size: 14px; }

    /* â”€â”€ MONTH SELECTOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .month-tabs {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .month-tab {
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 12.5px;
      font-weight: 600;
      border: 1.5px solid var(--lineL);
      background: #fff;
      cursor: pointer;
      transition: all .12s;
      color: var(--sub);
    }
    .month-tab:hover { border-color: var(--blue); color: var(--blue); }
    .month-tab.active { background: var(--blue); border-color: var(--blue); color: #fff; }

    /* â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: #fff;
      border: 1.5px solid var(--lineL);
      border-radius: var(--radius);
      padding: 16px 18px;
      animation: fadeUp .3s ease both;
    }
    .stat-label { font-size: 11px; font-weight: 600; letter-spacing: .6px; text-transform: uppercase; color: var(--sub); margin-bottom: 6px; }
    .stat-value { font-size: 28px; font-weight: 700; letter-spacing: -1px; color: var(--ink); }
    .stat-value.blue { color: var(--blue); }
    .stat-value.amber { color: var(--amber); }
    .stat-value.red   { color: var(--red); }
    .stat-value.teal  { color: var(--teal); }

    /* â”€â”€ LEGEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .legend-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 12px 16px;
      background: var(--snow);
      border-radius: 10px;
      border: 1.5px solid var(--lineL);
      margin-bottom: 18px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--sub);
    }

    /* â”€â”€ KALENDER RASTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(175px, 1fr));
      gap: 8px;
    }

    .cal-day {
      background: #fff;
      border: 1.5px solid var(--lineL);
      border-radius: 10px;
      padding: 8px 10px;
      min-height: 70px;
      transition: border-color .15s;
    }
    .cal-day:hover { border-color: rgba(46,124,246,.3); }
    .cal-day.weekend { background: #fafbff; }
    .cal-day.today {
      border-color: var(--blue);
      background: rgba(46,124,246,.04);
    }
    .cal-day.empty { opacity: .55; }

    .cal-day-header {
      display: flex;
      align-items: baseline;
      gap: 5px;
      margin-bottom: 6px;
      padding-bottom: 5px;
      border-bottom: 1px solid var(--lineL);
    }
    .cal-day-num {
      font-size: 15px;
      font-weight: 800;
      color: var(--ink);
      line-height: 1;
    }
    .cal-day.today .cal-day-num { color: var(--blue); }
    .cal-day-name {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .7px;
      color: var(--sub);
    }
    .cal-day.weekend .cal-day-name { color: #94a3b8; }

    .cal-entries {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cal-entry {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 4px;
      line-height: 1.2;
    }

    .cal-entry-name {
      font-size: 11px;
      font-weight: 700;
      white-space: nowrap;
      min-width: 45px;
    }

    .cal-entry-codes {
      display: flex;
      flex-wrap: wrap;
      gap: 3px;
    }

    /* â”€â”€ SCROLL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sidebar::-webkit-scrollbar,
    .main::-webkit-scrollbar,
    .table-scroll::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,.15); border-radius: 4px; }
    .main::-webkit-scrollbar-track,
    .table-scroll::-webkit-scrollbar-track { background: transparent; }
    .main::-webkit-scrollbar-thumb,
    .table-scroll::-webkit-scrollbar-thumb { background: rgba(13,27,42,.12); border-radius: 4px; }

    /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    /* â”€â”€ MOBILE BOTTOM NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .mobile-nav {
      display: none;
    }

    @media (max-width: 750px) {
      body { flex-direction: column; overflow: auto; }

      .sidebar {
        width: 100%;
        min-width: unset;
        height: auto;
        position: static;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        flex-wrap: nowrap;
      }
      .sidebar-logo { border-bottom: none; padding: 0; }
      .sidebar-logo .org { display: none; }
      .sidebar-logo h1 { font-size: 15px; }
      .sidebar-status { margin: 0; }
      .sidebar-nav, .sidebar-people { display: none; }

      .main { height: auto; overflow: visible; padding-bottom: 70px; }
      .content { padding: 12px; }

      /* Topbar compact */
      .topbar { padding: 10px 12px; gap: 8px; flex-wrap: nowrap; }
      .search-wrap { min-width: 0; flex: 1; }
      .tb-date { display: none; }
      .btn.primary { display: none; }
      .btn:not(.primary) { display: none; }

      /* Week grid smaller */
      .week-grid { grid-template-columns: 70px repeat(5, 1fr); font-size: 10px; }
      .wg-header.day-col .day-num { font-size: 13px; }
      .wg-cell { padding: 4px 3px; min-height: 36px; }

      /* Kalender compacter */
      .cal-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 6px; }

      /* Team grid compacter */
      .team-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; }

      /* Stats row */
      .stats-row { grid-template-columns: repeat(3, 1fr); gap: 8px; }
      .stat-value { font-size: 22px; }

      /* Mobile bottom nav */
      .mobile-nav {
        display: flex;
        position: fixed;
        bottom: 0; left: 0; right: 0;
        background: var(--navy);
        border-top: 1px solid var(--line);
        z-index: 100;
        padding: 0;
      }
      .mob-nav-item {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 10px 4px;
        gap: 3px;
        color: rgba(255,255,255,.45);
        cursor: pointer;
        font-size: 10px;
        font-weight: 600;
        letter-spacing: .3px;
        border-top: 2px solid transparent;
        transition: all .15s;
      }
      .mob-nav-item.active {
        color: #fff;
        border-top-color: var(--blue);
        background: rgba(46,124,246,.12);
      }
      .mob-nav-item .mob-icon { font-size: 18px; line-height: 1; }

      /* People picker op mobiel: horizontaal scrollbaar bovenaan content */
      .mob-people-strip {
        display: flex;
        gap: 6px;
        overflow-x: auto;
        padding: 0 0 10px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      .mob-people-strip::-webkit-scrollbar { display: none; }
      .mob-person-btn {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 5px 10px 5px 6px;
        border-radius: 999px;
        border: 1.5px solid var(--lineL);
        background: #fff;
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
        cursor: pointer;
        flex-shrink: 0;
        transition: all .12s;
      }
      .mob-person-btn.active {
        background: var(--navy);
        border-color: var(--navy);
        color: #fff;
      }
      .mob-person-btn .avatar {
        width: 20px; height: 20px;
        border-radius: 6px;
        font-size: 9px;
      }
    }
  </style>
</head>
<body>

<!-- â”€â”€ MOBILE BOTTOM NAV â”€â”€ -->
<nav class="mobile-nav">
  <div class="mob-nav-item active" data-mob-view="today">
    <span class="mob-icon">ğŸ“…</span>
    <span>Vandaag</span>
  </div>
  <div class="mob-nav-item" data-mob-view="week">
    <span class="mob-icon">ğŸ“†</span>
    <span>Week</span>
  </div>
  <div class="mob-nav-item" data-mob-view="list">
    <span class="mob-icon">ğŸ—“ï¸</span>
    <span>Maand</span>
  </div>
  <div class="mob-nav-item" id="mobPeopleBtn">
    <span class="mob-icon">ğŸ‘¤</span>
    <span>Persoon</span>
  </div>
</nav>

<!-- â”€â”€ MOBILE PEOPLE POPUP â”€â”€ -->
<div id="mobPeoplePopup" style="display:none; position:fixed; bottom:60px; left:0; right:0; background:#fff; border-top:1.5px solid var(--lineL); padding:14px 16px; z-index:99; box-shadow:0 -8px 24px rgba(13,27,42,.12);">
  <div style="font-size:11px; font-weight:700; letter-spacing:.8px; text-transform:uppercase; color:var(--sub); margin-bottom:10px;">Persoon kiezen</div>
  <div class="mob-people-strip" id="mobPeopleStrip"></div>
</div>

<!-- â”€â”€ SIDEBAR â”€â”€ -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="org">Klinisch Labo</div>
    <h1>ICT <span>Permanenties</span></h1>
  </div>
  <div class="sidebar-status">
    <div class="status-pill load" id="statusPill">
      <div class="status-dot"></div>
      <span id="statusText">Ladenâ€¦</span>
    </div>
    <div style="font-size:11px; color:rgba(255,255,255,.3); margin-top:8px; padding:0 2px;" id="genAt"></div>
  </div>

  <nav class="sidebar-nav">
    <div class="nav-label">Weergave</div>
    <div class="nav-item active" data-view="today">
      <span class="icon">ğŸ“…</span> Vandaag
    </div>
    <div class="nav-item" data-view="week">
      <span class="icon">ğŸ“†</span> Week
    </div>
    <div class="nav-item" data-view="list">
      <span class="icon">ğŸ—‚ï¸</span> Lijst
    </div>
  </nav>

  <div class="sidebar-people">
    <div class="people-label">Team</div>
    <div id="peopleList"></div>
  </div>
</aside>

<!-- â”€â”€ MAIN â”€â”€ -->
<div class="main">
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="search-wrap">
      <span class="search-icon">ğŸ”</span>
      <input type="text" id="globalSearch" placeholder="Zoek op naam, code, datumâ€¦"/>
    </div>
    <div class="tb-date">
      <input type="date" id="datePicker"/>
    </div>
    <button class="btn primary" id="btnToday">Vandaag</button>
    <button class="btn" id="btnReset">Reset</button>
  </div>

  <!-- CONTENT -->
  <div class="content">

    <!-- TODAY VIEW -->
    <div class="view active" id="view-today">
      <div class="today-header">
        <div>
          <div class="today-title" id="todayTitle">â€”</div>
          <div class="today-sub" id="todaySub">Wie is er aanwezig vandaag?</div>
        </div>
      </div>
      <div class="legend-row" id="legendRow"></div>
      <div class="stats-row" id="statsRow"></div>
      <div class="team-grid" id="teamGrid"></div>
    </div>

    <!-- WEEK VIEW -->
    <div class="view" id="view-week">
      <div class="week-nav">
        <button class="btn" id="btnPrevWeek">â† Vorige</button>
        <div class="week-label" id="weekLabel">â€”</div>
        <button class="btn" id="btnNextWeek">Volgende â†’</button>
      </div>
      <div id="weekGridWrap"></div>
    </div>

    <!-- LIST VIEW -->
    <div class="view" id="view-list">
      <div class="month-tabs" id="monthTabs"></div>
      <div id="calendarWrap"></div>
    </div>

  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONFIG
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DATA_URL = "permanentie.json";

// Kleurklassen per code (afwezig/wacht/hotline/norm)
// Labels worden dynamisch geladen vanuit de JSON legende
const CODE_CLASSES = {
  H: "hotline",
  w: "wacht", w1: "wacht", w2: "wacht", w3: "wacht",
  adv: "afwezig", gadv: "afwezig",
  v: "afwezig", vV: "afwezig", gvV: "afwezig",
  z: "afwezig",
  x: "afwezig", xg: "afwezig", xh: "afwezig", gx: "afwezig",
  kv: "afwezig", b: "afwezig", vbst: "afwezig",
};

// Wordt gevuld vanuit payload.legend na het laden
let CODE_MAP = {};

function buildCodeMapFromLegend(legendItems) {
  const map = {};
  for (const item of (legendItems || [])) {
    const code = item.code;
    const label = item.description;
    // Klasse bepalen: kijk eerst in CODE_CLASSES, daarna "norm"
    const cls = CODE_CLASSES[code] || "norm";
    map[code] = { label, cls };
  }
  return map;
}

const DAYS_NL = ["zo","ma","di","wo","do","vr","za"];
const DAYS_FULL = ["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"];
const MONTHS_NL = ["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let records    = [];
let allPeople  = [];
let payload    = null;
let activeView = "today";
let filterPerson = "";
let currentWeekStart = null; // Monday of displayed week

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function isoToday() {
  const d = new Date();
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
}
function pad(n){ return n < 10 ? "0"+n : ""+n; }

function formatDateNL(iso) {
  const [y,m,d] = iso.split("-").map(Number);
  const dt = new Date(y, m-1, d);
  return `${DAYS_NL[dt.getDay()]} ${d} ${MONTHS_NL[m-1]} ${y}`;
}

function isoFromDate(d) {
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
}

function addDays(isoOrDate, n) {
  const d = typeof isoOrDate === "string"
    ? new Date(...isoOrDate.split("-").map((v,i) => i===1?Number(v)-1:Number(v)))
    : new Date(isoOrDate);
  d.setDate(d.getDate() + n);
  return d;
}

function getMonday(dateStr) {
  const [y,m,d] = dateStr.split("-").map(Number);
  const dt = new Date(y, m-1, d);
  const day = dt.getDay();
  const diff = day === 0 ? -6 : 1 - day;
  dt.setDate(dt.getDate() + diff);
  return isoFromDate(dt);
}

function splitTokens(code) {
  return (code||"").split("/").map(s=>s.trim()).filter(Boolean);
}

function renderTags(code) {
  return splitTokens(code).map(t => {
    const def = CODE_MAP[t] || CODE_MAP[t.toLowerCase()];
    if (def) return `<span class="tag ${def.cls}">${def.label}</span>`;
    return `<span class="tag norm">${t.toUpperCase()}</span>`;
  }).join("");
}

function getTagClass(token) {
  const def = CODE_MAP[token] || CODE_MAP[token.toLowerCase()];
  if (def) return def.cls;
  // Fallback: check CODE_CLASSES direct
  return CODE_CLASSES[token] || CODE_CLASSES[token.toLowerCase()] || "norm";
}

function personInitials(name) {
  return name.split(" ").slice(0,2).map(w=>w[0]).join("").toUpperCase();
}

function avatarColor(name) {
  const colors = ["#1a4ecc","#0d7c70","#b45309","#9333ea","#0891b2","#be123c","#166534"];
  let h = 0;
  for(let i=0;i<name.length;i++) h = (h*31 + name.charCodeAt(i)) % colors.length;
  return colors[h];
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOAD DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setStatus(text, kind) {
  const pill = document.getElementById("statusPill");
  const span = document.getElementById("statusText");
  pill.className = "status-pill " + (kind||"");
  span.textContent = text;
}

async function loadData() {
  setStatus("Ladenâ€¦","load");
  try {
    const res = await fetch(`${DATA_URL}?v=${Date.now()}`, {cache:"no-store"});
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    let raw = await res.json();

    // Normaliseer alle mogelijke Power Automate wrapper-formaten
    // Formaat 1: { stdout: "..." }  (oud formaat)
    if (raw && typeof raw.stdout === "string") raw = JSON.parse(raw.stdout);
    // Formaat 2: { result: "..." }
    else if (raw && typeof raw.result === "string") raw = JSON.parse(raw.result);
    // Formaat 3: dubbel geÃ«ncoded string
    if (typeof raw === "string") raw = JSON.parse(raw);
    // Formaat 4: { returncode, stdout } (shell output wrapper)
    if (raw && typeof raw.stdout === "string") raw = JSON.parse(raw.stdout);

    payload = raw;
    records = (payload.records || []).filter(r =>
      r.person && r.person.toLowerCase() !== "legende"
    );

    // Bouw CODE_MAP vanuit de legende in de JSON
    CODE_MAP = buildCodeMapFromLegend(payload.legend || []);

    allPeople = [...new Set(records.map(r=>r.person))].sort((a,b)=>a.localeCompare(b,"nl"));

    if (payload.generatedAt) {
      const d = new Date(payload.generatedAt);
      document.getElementById("genAt").textContent =
        `Bijgewerkt: ${d.toLocaleDateString("nl-BE")} ${d.toLocaleTimeString("nl-BE",{hour:"2-digit",minute:"2-digit"})}`;
    }

    setStatus("Gesynchroniseerd","ok");
    buildPeopleList();
    buildMonthTabs();
    renderAll();
  } catch(e) {
    console.error(e);
    setStatus("Laadfouten (" + e.message + ")","err");
    // Toon fout in actieve view
    const errHtml = `<div class="empty-state"><div class="icon">âŒ</div><p style="color:#e84040;">Fout bij laden: ${e.message}</p><p style="font-size:12px;color:var(--sub);margin-top:8px;">Controleer of permanentie.json bereikbaar is.</p></div>`;
    const teamGrid = document.getElementById("teamGrid");
    if (teamGrid) teamGrid.innerHTML = errHtml;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIDEBAR â€“ PEOPLE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPeopleList() {
  const wrap = document.getElementById("peopleList");
  wrap.innerHTML = `
    <div class="person-chip ${filterPerson===''?'active':''}" data-person="">
      <div class="avatar" style="background:rgba(255,255,255,.15)">ğŸ‘¥</div>
      <span>Iedereen</span>
    </div>
  ` + allPeople.map(p => `
    <div class="person-chip ${filterPerson===p?'active':''}" data-person="${p}">
      <div class="avatar" style="background:${avatarColor(p)}">${personInitials(p)}</div>
      <span>${p}</span>
    </div>
  `).join("");

  wrap.querySelectorAll(".person-chip").forEach(el => {
    el.addEventListener("click", () => {
      filterPerson = el.dataset.person;
      wrap.querySelectorAll(".person-chip").forEach(c=>c.classList.remove("active"));
      el.classList.add("active");
      renderAll();
    });
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LEGEND ROW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildLegend() {
  const items = [
    {cls:"hotline", label:"H = Hotline"},
    {cls:"wacht",   label:"W/W1/W2 = Wachtdienst"},
    {cls:"afwezig", label:"V/ADV/Z = Afwezig"},
    {cls:"norm",    label:"Mi/Sa/Th = Aanwezig"},
  ];
  return items.map(i =>
    `<div class="legend-item"><span class="tag ${i.cls}" style="font-family:var(--sans);font-weight:600;">${i.label}</span></div>`
  ).join("");
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildStats(dateStr) {
  const day = records.filter(r => r.date === dateStr);
  const total   = allPeople.length;
  const aanwezig = day.filter(r => !splitTokens(r.code).every(t =>
    ["afwezig"].includes(getTagClass(t))
  )).length;
  const hotline = day.filter(r => splitTokens(r.code).includes("H")).length;
  const wacht   = day.filter(r => splitTokens(r.code).some(t=>["w","w1","w2","w3"].includes(t.toLowerCase()))).length;
  const afwezig = day.filter(r => splitTokens(r.code).every(t => getTagClass(t)==="afwezig")).length;

  return `
    <div class="stat-card" style="animation-delay:.0s">
      <div class="stat-label">Totaal team</div>
      <div class="stat-value">${total}</div>
    </div>
    <div class="stat-card" style="animation-delay:.05s">
      <div class="stat-label">Aanwezig</div>
      <div class="stat-value blue">${aanwezig}</div>
    </div>
    <div class="stat-card" style="animation-delay:.1s">
      <div class="stat-label">Hotline</div>
      <div class="stat-value red">${hotline}</div>
    </div>
    <div class="stat-card" style="animation-delay:.15s">
      <div class="stat-label">Wachtdienst</div>
      <div class="stat-value amber">${wacht}</div>
    </div>
    <div class="stat-card" style="animation-delay:.2s">
      <div class="stat-label">Afwezig</div>
      <div class="stat-value" style="color:var(--sub)">${afwezig}</div>
    </div>
  `;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TODAY VIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderToday() {
  const dateStr = document.getElementById("datePicker").value || isoToday();
  const q = document.getElementById("globalSearch").value.trim().toLowerCase();

  document.getElementById("todayTitle").innerHTML =
    `Permanenties â€” <span>${formatDateNL(dateStr)}</span>`;

  document.getElementById("legendRow").innerHTML = buildLegend();
  document.getElementById("statsRow").innerHTML  = buildStats(dateStr);

  let people = filterPerson ? [filterPerson] : allPeople;

  const grid = document.getElementById("teamGrid");

  const cards = people.map((person, i) => {
    const row = records.find(r => r.date === dateStr && r.person === person);
    const code = row ? row.code : null;

    if (q) {
      const hay = `${person} ${code||""}`.toLowerCase();
      if (!hay.includes(q)) return "";
    }

    const tags = code ? renderTags(code)
      : `<span class="tag empty">Geen data</span>`;

    return `
      <div class="team-card" style="animation-delay:${i*0.04}s">
        <div class="tc-top">
          <div class="tc-avatar" style="background:${avatarColor(person)}">${personInitials(person)}</div>
          <div class="tc-name">${person}</div>
        </div>
        <div class="tc-codes">${tags}</div>
      </div>
    `;
  }).join("");

  grid.innerHTML = cards || `<div class="empty-state"><div class="icon">ğŸ”</div><p>Geen resultaten.</p></div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// WEEK VIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderWeek() {
  if (!currentWeekStart) {
    currentWeekStart = getMonday(document.getElementById("datePicker").value || isoToday());
  }

  const days = Array.from({length:5}, (_,i) => isoFromDate(addDays(currentWeekStart, i)));
  const todayIso = isoToday();

  // Week label
  const startDate = new Date(...days[0].split("-").map((v,i)=>i===1?Number(v)-1:Number(v)));
  const endDate   = new Date(...days[4].split("-").map((v,i)=>i===1?Number(v)-1:Number(v)));
  document.getElementById("weekLabel").textContent =
    `Week van ${startDate.getDate()} ${MONTHS_NL[startDate.getMonth()]} â€” ${endDate.getDate()} ${MONTHS_NL[endDate.getMonth()]} ${endDate.getFullYear()}`;

  let people = filterPerson ? [filterPerson] : allPeople;
  const q = document.getElementById("globalSearch").value.trim().toLowerCase();
  if (q) people = people.filter(p => p.toLowerCase().includes(q));

  const dayNames = days.map(d => {
    const dt = new Date(...d.split("-").map((v,i)=>i===1?Number(v)-1:Number(v)));
    return { iso: d, name: DAYS_NL[dt.getDay()], num: dt.getDate(), isToday: d === todayIso };
  });

  let html = `<div class="week-grid">`;
  // Header row
  html += `<div class="wg-header">Medewerker</div>`;
  dayNames.forEach(d => {
    html += `<div class="wg-header day-col${d.isToday?" today-col":""}">
      <span class="day-name">${d.name}</span>
      <span class="day-num">${d.num}</span>
    </div>`;
  });

  // Person rows
  people.forEach(person => {
    html += `<div class="wg-person">
      <div class="avatar" style="background:${avatarColor(person)};width:22px;height:22px;font-size:9px;border-radius:6px;flex-shrink:0;">${personInitials(person)}</div>
      ${person}
    </div>`;
    days.forEach((d, di) => {
      const row = records.find(r => r.date === d && r.person === person);
      const tags = row ? renderTags(row.code) : "";
      html += `<div class="wg-cell${dayNames[di].isToday?" today-col":""}">${tags}</div>`;
    });
  });
  html += `</div>`;

  document.getElementById("weekGridWrap").innerHTML = html;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LIST VIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let activeMonth = null;

function buildMonthTabs() {
  const months = [...new Set(records.map(r => r.date.slice(0,7)))].sort();
  const todayMonth = isoToday().slice(0,7);
  if (!activeMonth) activeMonth = months.includes(todayMonth) ? todayMonth : (months[0]||null);

  const wrap = document.getElementById("monthTabs");
  wrap.innerHTML = months.map(m => {
    const [y,mo] = m.split("-");
    return `<div class="month-tab${m===activeMonth?" active":""}" data-month="${m}">
      ${MONTHS_NL[Number(mo)-1].slice(0,3)} ${y}
    </div>`;
  }).join("");

  wrap.querySelectorAll(".month-tab").forEach(el => {
    el.addEventListener("click", () => {
      activeMonth = el.dataset.month;
      wrap.querySelectorAll(".month-tab").forEach(t=>t.classList.remove("active"));
      el.classList.add("active");
      renderList();
    });
  });
}

function renderList() {
  const q = document.getElementById("globalSearch").value.trim().toLowerCase();
  const wrap = document.getElementById("calendarWrap");

  let filtered = records.slice();
  if (activeMonth) filtered = filtered.filter(r => r.date.startsWith(activeMonth));
  if (filterPerson) filtered = filtered.filter(r => r.person === filterPerson);
  if (q) filtered = filtered.filter(r => {
    const mapped = splitTokens(r.code).map(t => (CODE_MAP[t]||{}).label||t).join(" ");
    return `${r.date} ${r.person} ${r.code} ${mapped}`.toLowerCase().includes(q);
  });

  if (!activeMonth || !filtered.length) {
    wrap.innerHTML = `<div class="empty-state"><div class="icon">ğŸ“­</div><p>Geen data voor deze selectie.</p></div>`;
    return;
  }

  const [yr, mo] = activeMonth.split("-").map(Number);
  const daysInMonth = new Date(yr, mo, 0).getDate();
  const todayIso = isoToday();

  // Groepeer per dag
  const byDay = {};
  for (const r of filtered) {
    const day = Number(r.date.split("-")[2]);
    if (!byDay[day]) byDay[day] = [];
    byDay[day].push(r);
  }

  // Bouw kalender-raster
  let html = `<div class="cal-grid">`;

  for (let d = 1; d <= daysInMonth; d++) {
    const iso = `${yr}-${pad(mo)}-${pad(d)}`;
    const dt = new Date(yr, mo-1, d);
    const dayOfWeek = dt.getDay(); // 0=zo, 6=za
    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
    const isToday = iso === todayIso;
    const dayName = DAYS_NL[dayOfWeek];
    const entries = byDay[d] || [];

    let cls = "cal-day";
    if (isWeekend) cls += " weekend";
    if (isToday) cls += " today";
    if (!entries.length) cls += " empty";

    html += `<div class="${cls}">
      <div class="cal-day-header">
        <span class="cal-day-num">${d}</span>
        <span class="cal-day-name">${dayName}</span>
      </div>
      <div class="cal-entries">`;

    for (const r of entries) {
      const tokens = splitTokens(r.code);
      const chips = tokens.map(t => {
        const def = CODE_MAP[t];
        const label = def ? def.label : t.toUpperCase();
        const cls2 = def ? def.cls : (CODE_CLASSES[t] || "norm");
        return `<span class="tag ${cls2}" style="font-size:10px;padding:2px 6px;">${label}</span>`;
      }).join("");

      html += `<div class="cal-entry">
        <span class="cal-entry-name" style="color:${avatarColor(r.person)}">${r.person}</span>
        <span class="cal-entry-codes">${chips}</span>
      </div>`;
    }

    html += `</div></div>`;
  }

  html += `</div>`;
  wrap.innerHTML = html;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER ALL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAll() {
  if (activeView === "today") renderToday();
  else if (activeView === "week") renderWeek();
  else if (activeView === "list") renderList();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NAV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll(".nav-item").forEach(el => {
  el.addEventListener("click", () => {
    activeView = el.dataset.view;
    document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
    el.classList.add("active");
    document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
    document.getElementById("view-"+activeView).classList.add("active");
    renderAll();
  });
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TOPBAR CONTROLS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const datePicker = document.getElementById("datePicker");
datePicker.value = isoToday();
function switchView(viewName) {
  activeView = viewName;
  document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("active"));
  document.querySelector(`.nav-item[data-view="${viewName}"]`).classList.add("active");
  document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
  document.getElementById("view-" + viewName).classList.add("active");
  // Sync mobile nav ook
  document.querySelectorAll(".mob-nav-item[data-mob-view]").forEach(el => {
    el.classList.toggle("active", el.dataset.mobView === viewName);
  });
}

datePicker.addEventListener("change", () => {
  currentWeekStart = getMonday(datePicker.value || isoToday());
  // Datum kiezen heeft alleen zin in Vandaag/Week view â€” stuur door als in Lijst
  if (activeView === "list") switchView("today");
  renderAll();
});

document.getElementById("globalSearch").addEventListener("input", renderAll);

document.getElementById("btnToday").addEventListener("click", () => {
  const realToday = isoToday(); // altijd de echte datum, ongeacht wat in datepicker staat
  datePicker.value = realToday;
  currentWeekStart = getMonday(realToday);
  document.getElementById("globalSearch").value = "";
  switchView("today");
  renderAll();
});

document.getElementById("btnReset").addEventListener("click", () => {
  datePicker.value = "";
  filterPerson = "";
  document.getElementById("globalSearch").value = "";
  document.querySelectorAll(".person-chip").forEach(c => c.classList.remove("active"));
  document.querySelector('.person-chip[data-person=""]')?.classList.add("active");
  // Reset maandtab naar huidige maand
  const todayMonth = isoToday().slice(0, 7);
  const months = [...new Set(records.map(r => r.date.slice(0, 7)))].sort();
  activeMonth = months.includes(todayMonth) ? todayMonth : (months[0] || null);
  buildMonthTabs();
  renderAll();
});

document.getElementById("btnPrevWeek").addEventListener("click", () => {
  currentWeekStart = isoFromDate(addDays(currentWeekStart, -7));
  renderAll();
});
document.getElementById("btnNextWeek").addEventListener("click", () => {
  currentWeekStart = isoFromDate(addDays(currentWeekStart, 7));
  renderAll();
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MOBILE NAV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function syncMobileNav() {
  document.querySelectorAll(".mob-nav-item[data-mob-view]").forEach(el => {
    el.classList.toggle("active", el.dataset.mobView === activeView);
  });
}

document.querySelectorAll(".mob-nav-item[data-mob-view]").forEach(el => {
  el.addEventListener("click", () => {
    switchView(el.dataset.mobView);
    closeMobPeople();
    syncMobileNav();
    renderAll();
  });
});

// Persoon popup op mobiel
let mobPeopleOpen = false;
function closeMobPeople() {
  mobPeopleOpen = false;
  document.getElementById("mobPeoplePopup").style.display = "none";
}

document.getElementById("mobPeopleBtn").addEventListener("click", () => {
  mobPeopleOpen = !mobPeopleOpen;
  document.getElementById("mobPeoplePopup").style.display = mobPeopleOpen ? "block" : "none";
  if (mobPeopleOpen) buildMobPeopleStrip();
});

function buildMobPeopleStrip() {
  const strip = document.getElementById("mobPeopleStrip");
  const people = ["", ...allPeople];
  strip.innerHTML = people.map(p => {
    const label = p || "Iedereen";
    const av = p ? `<span class="avatar" style="background:${avatarColor(p)};display:inline-flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:#fff;">${personInitials(p)}</span>` : `<span class="avatar" style="background:rgba(13,27,42,.15);display:inline-flex;align-items:center;justify-content:center;font-size:11px;">ğŸ‘¥</span>`;
    return `<div class="mob-person-btn ${filterPerson===p?'active':''}" data-person="${p}">${av}${label}</div>`;
  }).join("");

  strip.querySelectorAll(".mob-person-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      filterPerson = btn.dataset.person;
      // Sync sidebar ook
      document.querySelectorAll(".person-chip").forEach(c => c.classList.remove("active"));
      document.querySelector(`.person-chip[data-person="${filterPerson}"]`)?.classList.add("active");
      buildMobPeopleStrip();
      closeMobPeople();
      renderAll();
    });
  });
}

// Sluit popup bij klik buiten
document.addEventListener("click", (e) => {
  if (mobPeopleOpen &&
      !document.getElementById("mobPeoplePopup").contains(e.target) &&
      !document.getElementById("mobPeopleBtn").contains(e.target)) {
    closeMobPeople();
  }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// START
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
currentWeekStart = getMonday(isoToday());
loadData();
}); // end DOMContentLoaded
</script>
</body>
</html>
