<!doctype html>
<!--
  ICT Permanenties Dashboard
  Laatste aanpassing: vrijdag 27 februari 2026 om 14:58
-->
<html lang="nl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ICT Labo â€” Permanenties</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg:      #eef0f8;
      --bg2:     #e8eaf5;
      --blue:    #3b5bdb;
      --blue2:   #4c6ef5;
      --blue3:   #748ffc;
      --blue4:   #e8ecff;
      --blue5:   #f0f2ff;
      --teal:    #0c8599;
      --amber:   #e67700;
      --amber2:  #fff3bf;
      --red:     #e03131;
      --red2:    #ffe3e3;
      --green:   #2f9e44;
      --green2:  #d3f9d8;
      --ink:     #1a1b2e;
      --ink2:    #2c2e4a;
      --sub:     #6b7299;
      --sub2:    #9da3c8;
      --card:    #ffffff;
      --line:    rgba(59,91,219,.1);
      --line2:   rgba(59,91,219,.06);
      --shadow:  0 2px 12px rgba(59,91,219,.08), 0 1px 3px rgba(0,0,0,.04);
      --shadow2: 0 8px 32px rgba(59,91,219,.12), 0 2px 8px rgba(0,0,0,.06);
      --shadow3: 0 16px 48px rgba(59,91,219,.15), 0 4px 12px rgba(0,0,0,.08);
      --radius:  16px;
      --sans:    'Inter', sans-serif;
      --mono:    'DM Mono', monospace;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      overflow: hidden;
    }

    /* Zachte achtergrond met lavendel tint */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      background:
        radial-gradient(ellipse 60% 50% at 5% 5%,   rgba(116,143,252,.18) 0%, transparent 50%),
        radial-gradient(ellipse 50% 40% at 95% 95%, rgba(12,133,153,.1)  0%, transparent 50%);
      pointer-events: none;
    }

    .sidebar, .main { position: relative; z-index: 1; }

    /* â”€â”€ SIDEBAR â”€â”€ */
    .sidebar {
      width: 250px; min-width: 250px;
      background: var(--ink);
      display: flex; flex-direction: column;
      height: 100vh; overflow-y: auto;
      position: sticky; top: 0;
      box-shadow: 4px 0 24px rgba(26,27,46,.15);
    }

    .sidebar-logo {
      padding: 28px 22px 20px;
      border-bottom: 1px solid rgba(255,255,255,.07);
    }
    .sidebar-logo .org {
      font-family: var(--mono);
      font-size: 10px; font-weight: 500;
      letter-spacing: 2.2px; text-transform: uppercase;
      color: var(--blue3); margin-bottom: 8px;
      display: flex; align-items: center; gap: 7px;
    }
    .sidebar-logo .org::before {
      content: '';
      display: inline-block; width: 6px; height: 6px;
      border-radius: 50%; background: var(--blue3);
      box-shadow: 0 0 8px var(--blue3);
    }
    .sidebar-logo h1 {
      font-size: 20px; font-weight: 800;
      letter-spacing: -.4px; line-height: 1.2; color: #fff;
    }
    .sidebar-logo h1 span {
      background: linear-gradient(120deg, var(--blue3), #74c0fc);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .sidebar-status { padding: 14px 22px 0; }
    .status-pill {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 6px 12px; border-radius: 999px;
      font-size: 11px; font-weight: 600;
      background: rgba(255,255,255,.07); color: rgba(255,255,255,.45);
      border: 1px solid rgba(255,255,255,.1);
    }
    .status-pill.ok   { background: rgba(47,158,68,.15); color: #69db7c; border-color: rgba(47,158,68,.25); }
    .status-pill.err  { background: rgba(224,49,49,.15); color: #ffa8a8; border-color: rgba(224,49,49,.25); }
    .status-pill.load { background: rgba(76,110,245,.2); color: var(--blue3); border-color: rgba(76,110,245,.3); }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.35} }

    #genAt { font-family: var(--mono); font-size: 10px; color: rgba(255,255,255,.75); margin-top: 7px; }

    .sidebar-nav { padding: 20px 0; flex: 1; }
    .nav-label {
      font-family: var(--mono); font-size: 9px; font-weight: 500;
      letter-spacing: 2px; text-transform: uppercase;
      color: rgba(255,255,255,.75); padding: 0 22px 10px;
    }
    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 11px 22px; font-size: 13.5px; font-weight: 500;
      color: rgba(255,255,255,.45); cursor: pointer;
      border-left: 2px solid transparent;
      transition: all .15s; user-select: none;
    }
    .nav-item:hover { color: rgba(255,255,255,.85); background: rgba(255,255,255,.06); }
    .nav-item.active {
      color: #fff; background: rgba(76,110,245,.2);
      border-left-color: var(--blue2); font-weight: 600;
    }
    .nav-item .icon { font-size: 15px; width: 18px; text-align: center; }

    .sidebar-people {
      padding: 12px 12px 20px;
      border-top: 1px solid rgba(255,255,255,.07);
    }
    .people-label {
      font-family: var(--mono); font-size: 9px; font-weight: 500;
      letter-spacing: 2px; text-transform: uppercase;
      color: rgba(255,255,255,.75); padding: 0 8px 10px;
    }
    .person-chip {
      display: flex; align-items: center; gap: 9px;
      padding: 7px 10px; border-radius: 10px;
      font-size: 13px; color: rgba(255,255,255,.45);
      cursor: pointer; transition: all .12s;
      border: 1px solid transparent;
    }
    .person-chip:hover { background: rgba(255,255,255,.07); color: rgba(255,255,255,.85); }
    .person-chip.active {
      background: rgba(76,110,245,.25);
      border-color: rgba(76,110,245,.4);
      color: #fff; font-weight: 600;
    }
    .person-chip.active::after { content: "âœ“"; margin-left: auto; font-size: 11px; color: var(--blue3); }
    .avatar {
      width: 26px; height: 26px; border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; font-weight: 700; flex-shrink: 0; color: #fff;
    }
    .sidebar::-webkit-scrollbar { width: 3px; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,.1); border-radius: 4px; }

    /* â”€â”€ MAIN â”€â”€ */
    .main { flex: 1; overflow-y: auto; height: 100vh; display: flex; flex-direction: column; }
    .main::-webkit-scrollbar { width: 4px; }
    .main::-webkit-scrollbar-thumb { background: rgba(59,91,219,.15); border-radius: 4px; }

    /* â”€â”€ TOPBAR â”€â”€ */
    .topbar {
      background: rgba(255,255,255,.7);
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--line);
      padding: 12px 24px;
      display: flex; align-items: center; gap: 10px;
      flex-wrap: wrap; position: sticky; top: 0; z-index: 10;
    }

    
    

    .tb-date input[type=date] {
      padding: 9px 12px; border: 1.5px solid var(--line);
      border-radius: 12px; font-family: var(--sans); font-size: 13.5px;
      color: var(--ink); background: #fff;
      outline: none; cursor: pointer; transition: all .15s;
      box-shadow: var(--shadow);
    }
    .tb-date input[type=date]:focus { border-color: var(--blue2); }

    .btn {
      padding: 9px 16px; border-radius: 12px;
      border: 1.5px solid var(--line);
      background: #fff;
      font-family: var(--sans); font-size: 13px; font-weight: 600;
      color: var(--ink2); cursor: pointer;
      display: inline-flex; align-items: center; gap: 7px;
      transition: all .15s; white-space: nowrap;
      box-shadow: var(--shadow);
    }
    .btn:hover { border-color: var(--blue2); color: var(--blue); background: var(--blue5); box-shadow: var(--shadow2); }
    .btn.primary {
      background: var(--blue); border-color: var(--blue); color: #fff;
      box-shadow: 0 4px 16px rgba(59,91,219,.35);
    }
    .btn.primary:hover { background: var(--blue2); box-shadow: 0 6px 22px rgba(59,91,219,.45); transform: translateY(-1px); }

    /* â”€â”€ CONTENT â”€â”€ */
    .content { padding: 24px 24px 48px; flex: 1; }
    .view { display: none; }
    .view.active { display: block; }

    /* â”€â”€ TITELS â”€â”€ */
    .today-title {
      font-size: 18px; font-weight: 700;
      letter-spacing: -.3px; color: var(--ink); margin-bottom: 2px;
    }
    .today-title span { color: var(--blue); }
    .today-sub { font-size: 12px; color: var(--sub); margin-bottom: 14px; }

    /* â”€â”€ STATS â”€â”€ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px; margin-bottom: 14px;
    }
    .stat-card {
      background: var(--card);
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: var(--shadow);
      border: 1.5px solid var(--line2);
      animation: fadeUp .4s ease both;
      position: relative; overflow: hidden;
      transition: transform .2s, box-shadow .2s;
    }
    .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow2); }
    .stat-card::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; height: 3px;
      border-radius: 16px 16px 0 0;
      background: var(--line2);
    }
    .stat-card.accent-blue::before  { background: var(--blue); }
    .stat-card.accent-red::before   { background: var(--red); }
    .stat-card.accent-amber::before { background: #ffd43b; }
    .stat-card.accent-green::before { background: #2f9e44; }
    .stat-card.accent-sub::before    { background: var(--sub2); }
    .stat-card.accent-sub .stat-value { color: var(--ink2); }
    .stat-card.accent-purple::before  { background: #7c3aed; }
    .stat-card.accent-purple .stat-value { color: #7c3aed; }
    .stat-card.accent-orange::before  { background: #e8590c; }
    .stat-card.accent-orange .stat-value { color: #e8590c; }
    .stat-label {
      font-family: var(--mono);
      font-size: 9px; letter-spacing: 2px; text-transform: uppercase; font-weight: 600;
      color: var(--sub2); margin-bottom: 6px;
    }
    .stat-card.accent-blue   .stat-value { color: var(--blue) !important; }
    .stat-card.accent-green  .stat-value { color: #2f9e44 !important; }
    .stat-card.accent-green::before { background: #2f9e44; }
    .stat-card.accent-red    .stat-value { color: var(--red) !important; }
    .stat-card.accent-amber  .stat-value { color: #f08c00 !important; }
    .stat-card.accent-orange .stat-value { color: #e8590c !important; }
    .stat-card.accent-sub    .stat-value { color: var(--sub) !important; }
    .stat-value { font-size: 36px; font-weight: 900; letter-spacing: -2px; color: var(--ink); }
    .stat-card.accent-blue  .stat-card.accent-amber .stat-card.accent-red   @keyframes fadeUp {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* â”€â”€ LEGEND â”€â”€ */
    .legend-row { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--sub); }

    /* â”€â”€ CODE FILTER ROW â”€â”€ */
    .code-filter-row {
      display: flex; flex-wrap: wrap; gap: 6px;
      margin-bottom: 16px; align-items: center;
    }
    .code-filter-label {
      font-family: var(--mono); font-size: 10px; font-weight: 500;
      letter-spacing: 1.5px; text-transform: uppercase;
      color: var(--sub2); margin-right: 4px; white-space: nowrap;
    }
    .cf-btn {
      display: inline-flex; align-items: center;
      padding: 5px 12px; border-radius: 8px;
      font-size: 11px; font-weight: 700;
      font-family: var(--mono); letter-spacing: .3px;
      cursor: pointer; transition: all .15s;
      border: 1.5px solid; white-space: nowrap;
      user-select: none; box-shadow: var(--shadow);
    }
    .cf-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow2); }
    .cf-btn.active { box-shadow: var(--shadow2); transform: translateY(-1px); filter: brightness(.93); }
    .cf-clear {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 5px 12px; border-radius: 8px;
      font-size: 11px; font-weight: 600; font-family: var(--sans);
      cursor: pointer; transition: all .15s;
      border: 1.5px solid var(--line);
      background: #fff; color: var(--sub);
      white-space: nowrap; user-select: none;
      box-shadow: var(--shadow);
    }
    .cf-clear:hover { border-color: var(--blue2); color: var(--blue); background: var(--blue5); }

    /* â”€â”€ TEAM CARDS â”€â”€ */
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
    }
    .team-card {
      background: var(--card);
      border: 1.5px solid var(--line2);
      border-left: 3.5px solid var(--line2);
      border-radius: 14px;
      padding: 14px 15px;
      box-shadow: 0 2px 8px rgba(59,91,219,.06);
      transition: all .2s; animation: fadeUp .35s ease both;
      overflow: hidden; min-width: 0;
    }
    .team-card:hover {
      box-shadow: 0 6px 24px rgba(59,91,219,.13);
      transform: translateY(-2px);
    }
    .team-card:hover {
      border-color: rgba(59,91,219,.2);
      box-shadow: var(--shadow2);
      transform: translateY(-3px);
    }
    .team-card.grp-hotline { border-left-color: var(--red); }
    .team-card.grp-hotline:hover { box-shadow: 0 8px 32px rgba(224,49,49,.12); }
    .team-card.grp-wacht   { border-left-color: var(--amber); }
    .team-card.grp-norm    { border-left-color: var(--blue2); }
    .team-card.grp-afwezig { border-left-color: var(--sub2); opacity: .7; }
    .team-card.grp-geen    { border-left-color: var(--line2); opacity: .45; }

    /* Middelheim highlight */
    .team-card.grp-middelheim {
      border-left-color: #16a34a;
      border: 2px solid #16a34a;
      box-shadow: 0 0 0 0 rgba(22,163,74,.5), var(--shadow);
      animation: fadeUp .35s ease both, middelheimPulse 2s ease-in-out infinite;
    }
    .team-card.grp-middelheim:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 0 4px rgba(22,163,74,.2), var(--shadow2);
    }
    @keyframes middelheimPulse {
      0%   { box-shadow: 0 0 0 0   rgba(22,163,74,.45), var(--shadow); }
      50%  { box-shadow: 0 0 0 6px rgba(22,163,74,.0),  var(--shadow); }
      100% { box-shadow: 0 0 0 0   rgba(22,163,74,.45), var(--shadow); }
    }

    .tc-top { display: flex; align-items: center; gap: 9px; margin-bottom: 8px; }
    .tc-avatar {
      width: 32px; height: 32px; border-radius: 9px;
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; font-weight: 600; flex-shrink: 0; color: #fff;
    }
    .tc-name { font-size: 13px; font-weight: 600; color: var(--ink); }
    .tc-codes { display: flex; flex-wrap: wrap; gap: 5px; overflow: hidden; }

    /* â”€â”€ TAGS â”€â”€ */
    .tag {
      display: inline-flex; align-items: center;
      padding: 3px 9px; border-radius: 7px;
      font-size: 11px; font-weight: 500;
      font-family: var(--sans); letter-spacing: 0;
      white-space: normal; word-break: break-word;
    }
    .tag.norm    { background: var(--blue5); color: var(--blue); border: 1.5px solid rgba(59,91,219,.2); }
    .tag.hotline { background: var(--red); color: #fff; border: 1.5px solid var(--red); box-shadow: 0 2px 10px rgba(224,49,49,.25); font-weight: 700; }
    .tag.wacht   { background: var(--amber2); color: var(--amber); border: 1.5px solid #ffd43b; }
    .tag.afwezig { background: var(--bg); color: var(--sub); border: 1.5px solid var(--line); }
    .tag.empty   { color: var(--sub2); font-family: var(--sans); font-weight: 400; font-size: 12px; font-style: italic; }

    /* â”€â”€ WEEK VIEW â”€â”€ */
    .week-nav { display: flex; align-items: center; gap: 10px; margin-bottom: 18px; }
    .week-label { font-size: 17px; font-weight: 700; flex: 1; text-align: center; color: var(--ink); }
    .week-grid {
      display: grid;
      grid-template-columns: 130px repeat(5, 1fr);
      gap: 3px; border-radius: var(--radius); overflow: hidden;
      box-shadow: var(--shadow2);
      border: 1.5px solid var(--line);
    }
    .wg-header {
      background: var(--bg2); color: var(--sub);
      font-size: 11px; font-weight: 600; padding: 11px 12px; text-align: center;
    }
    .wg-header.day-col { display: flex; flex-direction: column; align-items: center; gap: 2px; }
    .wg-header.day-col .day-name { font-family: var(--mono); font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: var(--sub2); }
    .wg-header.day-col .day-num  { font-size: 20px; font-weight: 800; color: var(--ink); letter-spacing: -1px; }
    .wg-header.day-col.today-col { background: var(--blue4); }
    .wg-header.day-col.today-col .day-num { color: var(--blue); }
    .wg-person {
      background: #fff; color: var(--ink2);
      font-size: 12px; font-weight: 600; padding: 9px 12px;
      display: flex; align-items: center; gap: 8px;
      border-top: 1px solid var(--line2);
    }
    .wg-cell {
      background: rgba(255,255,255,.7); padding: 7px 5px;
      display: flex; flex-wrap: wrap; gap: 3px;
      align-items: flex-start; min-height: 44px;
      border-top: 1px solid var(--line2);
    }
    .wg-cell.today-col { background: var(--blue5); }

    /* â”€â”€ MONTH TABS â”€â”€ */
    .month-tabs { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 18px; }
    .month-tab {
      padding: 7px 15px; border-radius: 10px;
      font-size: 12px; font-weight: 600;
      border: 1.5px solid var(--line);
      background: #fff;
      cursor: pointer; transition: all .12s; color: var(--sub);
      font-family: var(--mono);
      box-shadow: var(--shadow);
    }
    .month-tab:hover { border-color: var(--blue2); color: var(--blue); background: var(--blue5); box-shadow: var(--shadow2); }
    .month-tab.active { background: var(--blue); border-color: var(--blue); color: #fff; box-shadow: 0 4px 14px rgba(59,91,219,.3); }

    /* â”€â”€ KALENDER â”€â”€ */
    .cal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(175px, 1fr));
      gap: 8px;
    }
    .cal-day {
      background: var(--card);
      border: 1.5px solid var(--line2);
      border-radius: 14px; padding: 10px 12px; min-height: 72px;
      box-shadow: var(--shadow);
      transition: all .15s;
    }
    .cal-day:hover { border-color: rgba(59,91,219,.2); box-shadow: var(--shadow2); transform: translateY(-1px); }
    .cal-day.weekend { background: var(--bg2); opacity: .8; }
    .cal-day.today   { border-color: rgba(59,91,219,.35); background: var(--blue5); }
    .cal-day.empty   { opacity: .4; }
    .cal-day-header  { display: flex; align-items: baseline; gap: 5px; margin-bottom: 7px; padding-bottom: 6px; border-bottom: 1px solid var(--line2); }
    .cal-day-num { font-size: 16px; font-weight: 800; color: var(--ink); line-height: 1; letter-spacing: -.5px; }
    .cal-day.today .cal-day-num { color: var(--blue); }
    .cal-day-name { font-family: var(--mono); font-size: 9px; font-weight: 500; text-transform: uppercase; letter-spacing: .8px; color: var(--sub2); }
    .cal-entries { display: flex; flex-direction: column; gap: 4px; }
    .cal-entry { display: flex; flex-wrap: wrap; align-items: center; gap: 4px; }
    .cal-entry-name { font-size: 11px; font-weight: 700; white-space: nowrap; min-width: 42px; }
    .cal-entry-codes { display: flex; flex-wrap: wrap; gap: 3px; }

    .btn#btnFilter.active {
      background: var(--blue); border-color: var(--blue); color: #fff;
      box-shadow: 0 4px 14px rgba(59,91,219,.3);
    }
    .cf-btn {
      display: inline-flex; align-items: center;
      padding: 5px 12px; border-radius: 8px;
      font-size: 11px; font-weight: 700;
      font-family: var(--mono); letter-spacing: .3px;
      cursor: pointer; transition: all .15s;
      border: 1.5px solid; white-space: nowrap;
      user-select: none; box-shadow: var(--shadow);
    }
    .cf-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow2); }
    .cf-btn.active { transform: translateY(-1px); box-shadow: var(--shadow2); outline: 2px solid var(--blue); outline-offset: 1px; }

    /* â”€â”€ DAG NAV PIJLTJES â”€â”€ */
    .day-nav-btn {
      width: 32px; height: 32px;
      border-radius: 10px;
      border: 1.5px solid var(--line);
      background: var(--card);
      color: var(--ink2);
      font-size: 20px; line-height: 1;
      cursor: pointer; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      box-shadow: var(--shadow);
      transition: all .15s;
    }
    .day-nav-btn:hover {
      border-color: var(--blue2); color: var(--blue);
      background: var(--blue5); box-shadow: var(--shadow2);
    }

    /* â”€â”€ MORGEN STRIP â”€â”€ */
    .morgen-strip {
      display: flex; gap: 12px; margin-bottom: 14px; flex-wrap: wrap;
      align-items: center;
      padding: 7px 12px;
      background: var(--card);
      border-radius: 10px;
      border: 1.5px solid var(--line2);
      box-shadow: var(--shadow);
      font-size: 12px; color: var(--sub);
    }
    .morgen-strip-label {
      font-family: var(--mono); font-size: 9px; font-weight: 500;
      letter-spacing: 1.5px; text-transform: uppercase;
      color: var(--sub2); white-space: nowrap;
    }
    .morgen-item {
      display: inline-flex; align-items: center; gap: 5px;
      white-space: nowrap;
    }
    .morgen-item .tag { font-size: 10px; padding: 2px 7px; }

    /* â”€â”€ VIEW TRANSITIONS â”€â”€ */
    .view {
      animation: none;
    }
    .view.active {
      animation: viewFadeIn .25s ease both;
    }
    .view.active {
      animation: viewFadeIn .45s cubic-bezier(.22,.68,0,1.15) both;
    }
    @keyframes viewFadeIn {
      from { opacity: 0; transform: translateY(30px) scale(.95); filter: blur(4px); }
      to   { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
    }

    /* â”€â”€ SKELETON LOADING â”€â”€ */
    .skeleton-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
    }
    .skeleton-card {
      background: var(--card);
      border: 1.5px solid var(--line2);
      border-radius: var(--radius);
      padding: 12px 13px;
      box-shadow: var(--shadow);
    }
    .skeleton-line {
      border-radius: 6px;
      background: linear-gradient(90deg, #d0d4ed 20%, #eaecff 50%, #d0d4ed 80%);
      background-size: 400% 100%;
      animation: shimmer .9s ease-in-out infinite;
    }
    @keyframes shimmer {
      0%   { background-position: 100% 0; }
      100% { background-position: -100% 0; }
    }
    .skeleton-avatar {
      width: 32px; height: 32px; border-radius: 9px;
      background: linear-gradient(90deg, #d0d4ed 20%, #eaecff 50%, #d0d4ed 80%);
      background-size: 400% 100%;
      animation: shimmer .9s ease-in-out infinite;
      flex-shrink: 0;
    }
    .skeleton-stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px; margin-bottom: 14px;
    }
    .skeleton-stat {
      background: var(--card);
      border-radius: 12px; padding: 11px 14px;
      box-shadow: var(--shadow);
      border: 1.5px solid var(--line2);
    }

    /* â”€â”€ FRIYAY OVERLAY â”€â”€ */
    .friyay-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex; align-items: center; justify-content: center;
      z-index: 1000; pointer-events: none;
      animation: friyayShow 3.5s ease forwards;
    }
    .friyay-text {
      font-size: clamp(40px, 10vw, 90px);
      font-weight: 900;
      letter-spacing: -2px;
      background: linear-gradient(135deg, #f59f00, #ffd43b, #fab005, #ffe066);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: none;
      filter: drop-shadow(0 4px 24px rgba(245,159,0,.5));
      animation: friyayPop 3.5s ease forwards;
    }
    @keyframes friyayPop {
      0%   { opacity: 0; transform: scale(.5); }
      20%  { opacity: 1; transform: scale(1.08); }
      35%  { transform: scale(1); }
      70%  { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(1.1); }
    }

    /* â”€â”€ CONFETTI â”€â”€ */
    .confetti-piece {
      position: fixed;
      width: 10px; height: 10px;
      top: -10px;
      border-radius: 2px;
      opacity: 0;
      animation: confettiFall linear forwards;
      z-index: 999;
      pointer-events: none;
    }
    @keyframes confettiFall {
      0%   { transform: translateY(0) rotate(0deg); opacity: 1; }
      80%  { opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    .team-complete-banner {
      display: flex; align-items: center; justify-content: center; gap: 12px;
      background: #3b5bdb;
      transition: background 0.6s ease;
      animation: bannerPop .6s cubic-bezier(.22,.68,0,1.35) both;
      color: #fff; border-radius: 16px;
      padding: 7px 16px; margin-bottom: 12px;
      font-size: 12px; font-weight: 600;
      letter-spacing: -.3px;
      box-shadow: 0 8px 32px rgba(59,91,219,.4), 0 2px 8px rgba(0,0,0,.1);
      text-align: center;
    }

    @keyframes bannerPop {
      0%   { opacity: 0; transform: scale(.7) translateY(20px); }
      70%  { transform: scale(1.04) translateY(-4px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }

    /* â”€â”€ EMPTY STATE â”€â”€ */
    .empty-state { padding: 60px 20px; text-align: center; color: var(--sub); }
    .empty-state .icon { font-size: 40px; margin-bottom: 12px; }
    .empty-state p { font-size: 14px; }

    /* â”€â”€ MOBILE â”€â”€ */
    .mobile-nav { display: none; }

    @media (max-width: 750px) {
      body { flex-direction: column; overflow: auto; }
      .sidebar {
        width: 100%; min-width: unset; height: auto; position: static;
        flex-direction: row; align-items: center; justify-content: space-between;
        padding: 10px 14px; flex-wrap: nowrap;
      }
      .sidebar-logo { border-bottom: none; padding: 0; }
      .sidebar-logo .org { display: none; }
      .sidebar-logo h1 { font-size: 16px; }
      .sidebar-status { margin: 0; }
      .sidebar-nav, .sidebar-people { display: none; }
      .main { height: auto; overflow: visible; padding-bottom: 68px; }
      .topbar { padding: 8px 12px; gap: 6px; flex-wrap: nowrap; }
      .search-wrap { display: none; }
      .tb-date { display: none; }
      #mobDateRow { display: flex !important; }
      .btn.primary, .btn:not(.primary) { display: none; }
      .content { padding: 10px 10px 16px; }
      .team-grid { grid-template-columns: 1fr 1fr; gap: 8px; }
      .team-card { padding: 11px; }
      .tc-avatar { width: 30px; height: 30px; font-size: 10px; border-radius: 9px; }
      .tc-name { font-size: 12px; }
      .tag { font-size: 10px; padding: 3px 7px; }
      .today-title { font-size: 17px; }
      .stats-row { grid-template-columns: repeat(3,1fr); gap: 6px; }
      .stat-card { padding: 10px 12px; }
      
      .legend-row { display: none; }
      .week-grid { display: none; }
      #weekMobileWrap { display: block; }
      .cal-grid { grid-template-columns: 1fr 1fr; gap: 6px; }
      .cal-day { padding: 6px 8px; min-height: 54px; }

      #filterPanel {
        position: static !important;
        bottom: auto !important;
        top: auto !important;
        border: 1.5px solid var(--line) !important;
        border-radius: 12px;
        margin: 0 0 12px 0;
        box-shadow: var(--shadow);
        max-height: none;
        padding: 10px 12px !important;
      }

      .mobile-nav {
        display: flex; position: fixed; bottom: 0; left: 0; right: 0;
        background: rgba(255,255,255,.85);
        backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
        border-top: 1px solid var(--line);
        box-shadow: 0 -4px 20px rgba(59,91,219,.08);
        z-index: 100;
      }
      .mob-nav-item {
        flex: 1; display: flex; flex-direction: column;
        align-items: center; justify-content: center;
        padding: 8px 4px; gap: 3px;
        color: var(--sub2); cursor: pointer;
        font-size: 10px; font-weight: 600; letter-spacing: .3px;
        border-top: 2px solid transparent; transition: all .15s;
      }
      .mob-nav-item.active { color: var(--blue); border-top-color: var(--blue); }
      .mob-icon { font-size: 17px; line-height: 1; }

      .mob-people-strip {
        display: flex; gap: 6px; overflow-x: auto; padding: 0 0 6px;
        -webkit-overflow-scrolling: touch; scrollbar-width: none;
      }
      .mob-people-strip::-webkit-scrollbar { display: none; }
      .mob-person-btn {
        display: inline-flex; align-items: center; gap: 5px;
        padding: 5px 10px 5px 6px; border-radius: 999px;
        border: 1.5px solid var(--line); background: #fff;
        font-size: 12px; font-weight: 600; white-space: nowrap;
        cursor: pointer; flex-shrink: 0; color: var(--ink); transition: all .12s;
        box-shadow: var(--shadow);
      }
      .mob-person-btn.active { background: var(--blue4); border-color: rgba(59,91,219,.3); color: var(--blue); }
      .mob-person-btn .avatar { width: 20px; height: 20px; border-radius: 6px; font-size: 9px; }
    }
  </style>
</head>
<body>

<!-- â”€â”€ MOBILE BOTTOM NAV â”€â”€ -->
<nav class="mobile-nav">
  <div class="mob-nav-item active" data-mob-view="today"><span class="mob-icon">ğŸ“…</span><span>Vandaag</span></div>
  <div class="mob-nav-item" data-mob-view="week"><span class="mob-icon">ğŸ“†</span><span>Week</span></div>
  <div class="mob-nav-item" data-mob-view="list"><span class="mob-icon">ğŸ—“ï¸</span><span>Maand</span></div>
  <div class="mob-nav-item" id="mobFilterBtn"><span class="mob-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg></span><span>Filter <span id="mobFilterDot" style="display:none;background:var(--blue);color:#fff;border-radius:999px;padding:0 5px;font-size:9px;vertical-align:middle;">1</span></span></div>
  <div class="mob-nav-item" id="mobPeopleBtn"><span class="mob-icon">ğŸ‘¤</span><span>Persoon</span></div>
</nav>

<!-- â”€â”€ MOBILE PEOPLE POPUP â”€â”€ -->
<div id="mobPeoplePopup" style="display:none; position:fixed; bottom:60px; left:0; right:0; background:rgba(255,255,255,.95); backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px); border-top:1.5px solid rgba(59,91,219,.1); padding:14px 16px; z-index:99; box-shadow:0 -8px 32px rgba(59,91,219,.12);">
  <div style="font-family:var(--mono);font-size:9px;font-weight:500;letter-spacing:2px;text-transform:uppercase;color:var(--sub2);margin-bottom:10px;">Persoon kiezen</div>
  <div class="mob-people-strip" id="mobPeopleStrip"></div>
</div>

<!-- â”€â”€ SIDEBAR â”€â”€ -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="org">Klinisch Labo</div>
    <h1>ICT <span>Permanenties</span></h1>
  </div>
  <div class="sidebar-status">
    <div class="status-pill load" id="statusPill">
      <div class="status-dot"></div>
      <span id="statusText">Ladenâ€¦</span>
    </div>
    <div id="genAt"></div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-label">Weergave</div>
    <div class="nav-item active" data-view="today"><span class="icon">ğŸ“…</span> Vandaag</div>
    <div class="nav-item" data-view="week"><span class="icon">ğŸ“†</span> Week</div>
    <div class="nav-item" data-view="list"><span class="icon">ğŸ—‚ï¸</span> Maand</div>
  </nav>
  <div class="sidebar-people">
    <div class="people-label">Team</div>
    <div id="peopleList"></div>
  </div>
</aside>

<!-- â”€â”€ MAIN â”€â”€ -->
<div class="main">
  <div class="topbar">
    <div id="topbarNotice" style="
      flex: 1;
      display: flex; align-items: center; gap: 8px;
      font-size: 12px; color: var(--sub);
      font-family: var(--sans);
      min-width: 0;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    ">
      <span id="topbarNoticeText" style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"></span>
    </div>
    <div class="tb-date">
      <input type="date" id="datePicker"/>
    </div>
    <button class="btn primary" id="btnToday">Vandaag</button>
    <button class="btn" id="btnFilter" title="Filter op code">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
      Filter <span id="filterBadge" style="display:none;background:var(--blue);color:#fff;border-radius:999px;padding:1px 6px;font-size:10px;margin-left:2px;"></span>
    </button>
    <button class="btn" id="btnReset">Reset</button>
    <div id="mobDateRow" style="display:none; width:100%; align-items:center; gap:6px; flex-wrap:nowrap;">
      <input type="date" id="datePickerMob" style="flex:1;padding:8px 10px;border:1.5px solid rgba(59,91,219,.1);border-radius:10px;font-family:var(--sans);font-size:13px;color:var(--ink);background:#fff;outline:none;box-shadow:0 2px 8px rgba(59,91,219,.06);"/>
      <button id="btnTodayMob" style="padding:8px 14px;border-radius:10px;border:none;background:var(--blue);color:#fff;font-family:var(--sans);font-size:13px;font-weight:700;cursor:pointer;white-space:nowrap;box-shadow:0 3px 12px rgba(59,91,219,.3);">Vandaag</button>
    </div>
  </div>

  <!-- â”€â”€ FILTER PANEL â”€â”€ -->
  <div id="filterPanel" style="display:none; background:rgba(255,255,255,.95); backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px); border-bottom:1.5px solid var(--line); padding:12px 16px; position:sticky; top:57px; z-index:9;">
    <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
      <span style="font-family:var(--mono);font-size:10px;font-weight:500;letter-spacing:1.5px;text-transform:uppercase;color:var(--sub2);flex:1;">Code filter:</span>
      <span id="filterClearAll" style="display:none; cursor:pointer; font-size:11px; font-weight:600; color:var(--sub); padding:4px 9px; border:1.5px solid var(--line); border-radius:8px; background:#fff; white-space:nowrap;" onclick="if(typeof clearCodeFilter!=='undefined') clearCodeFilter()">âœ• Wis filter</span>
      <span onclick="document.getElementById('filterPanel').style.display='none'" style="cursor:pointer;width:26px;height:26px;border-radius:8px;background:var(--bg);display:inline-flex;align-items:center;justify-content:center;font-size:14px;color:var(--sub);flex-shrink:0;">âœ•</span>
    </div>
    <div id="filterBtns" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
  </div>

  <div class="content">
    <div class="view active" id="view-today">
      <div class="today-header" style="display:flex; align-items:center; gap:10px; margin-bottom:2px;">
        <button class="day-nav-btn" id="btnPrevDay" title="Vorige dag">â€¹</button>
        <div style="flex:1;">
          <div class="today-title" id="todayTitle">â€”</div>
          <div class="today-sub" id="todaySub">Wie is er aanwezig vandaag?</div>
        </div>
        <button class="day-nav-btn" id="btnNextDay" title="Volgende dag">â€º</button>
      </div>
      <div class="legend-row" id="legendRow"></div>
      <div class="stats-row" id="statsRow"></div>
      <div class="morgen-strip" id="morgenStrip"></div>
      <div id="teamCompleteBanner"></div>
      <div class="team-grid" id="teamGrid"></div>
    </div>

    <div class="view" id="view-week">
      <div class="week-nav">
        <button class="btn" id="btnPrevWeek">â† Vorige</button>
        <div class="week-label" id="weekLabel">â€”</div>
        <button class="btn" id="btnNextWeek">Volgende â†’</button>
      </div>
      <div id="weekGridWrap"></div>
      <div id="weekMobileWrap" style="display:none;"></div>
    </div>

    <div class="view" id="view-list">
      <div class="month-tabs" id="monthTabs"></div>
      <div id="calendarWrap"></div>
    </div>
  </div>
</div>

<script>
// Globale foutopvang
window.onerror = function(msg, src, line, col, err) {
  const pill = document.getElementById("statusPill");
  const span = document.getElementById("statusText");
  if (pill) pill.className = "status-pill err";
  if (span) span.textContent = "JS Fout: " + msg + " (regel " + line + ")";
  const grid = document.getElementById("teamGrid");
  if (grid) grid.innerHTML = `<div class="empty-state"><div class="icon">âŒ</div><p style="color:var(--red);">Fout: ${msg}<br><small>Regel ${line}</small></p></div>`;
  return false;
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONFIG
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DATA_URL = "permanentie.json";

// Kleurklassen per code (afwezig/wacht/hotline/norm)
// Labels worden dynamisch geladen vanuit de JSON legende
const CODE_CLASSES = {
  H: "hotline",
  w: "wacht", w1: "wacht", w2: "wacht", w3: "wacht",
  adv: "afwezig", gadv: "afwezig",
  v: "afwezig", vV: "afwezig", gvV: "afwezig",
  z: "afwezig",
  x: "afwezig", xg: "afwezig", xh: "afwezig", gx: "afwezig",
  kv: "afwezig", b: "afwezig", vbst: "afwezig",
};

// Wordt gevuld vanuit payload.legend na het laden
let CODE_MAP = {};

function buildCodeMapFromLegend(legendItems) {
  const map = {};
  for (const item of (legendItems || [])) {
    const code = item.code;
    const label = item.description;
    // Klasse bepalen: kijk eerst in CODE_CLASSES, daarna "norm"
    const cls = CODE_CLASSES[code] || "norm";
    map[code] = { label, cls };
  }
  return map;
}

const DAYS_NL = ["zo","ma","di","wo","do","vr","za"];
const DAYS_FULL = ["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"];
const MONTHS_NL = ["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let records    = [];
let allPeople  = [];
let payload    = null;
let activeView = "today";
let filterPerson = "";
let filterCode = "";   // actieve code-filter (geldt voor alle views)
let currentWeekStart = null; // Monday of displayed week

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function isoToday() {
  const d = new Date();
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
}
function pad(n){ return n < 10 ? "0"+n : ""+n; }

function formatDateNL(iso) {
  const [y,m,d] = iso.split("-").map(Number);
  const dt = new Date(y, m-1, d);
  return `${DAYS_NL[dt.getDay()]} ${d} ${MONTHS_NL[m-1]} ${y}`;
}

function isoFromDate(d) {
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
}

function addDays(isoOrDate, n) {
  const d = typeof isoOrDate === "string"
    ? new Date(...isoOrDate.split("-").map((v,i) => i===1?Number(v)-1:Number(v)))
    : new Date(isoOrDate);
  d.setDate(d.getDate() + n);
  return d;
}

function getMonday(dateStr) {
  const [y,m,d] = dateStr.split("-").map(Number);
  const dt = new Date(y, m-1, d);
  const day = dt.getDay();
  const diff = day === 0 ? -6 : 1 - day;
  dt.setDate(dt.getDate() + diff);
  return isoFromDate(dt);
}

function splitTokens(code) {
  return (code||"").split("/").map(s=>s.trim()).filter(Boolean);
}

// Vaste kleurenpalet per code â€” elke code krijgt een unieke kleur
const CODE_COLORS = {
  // Locaties â€” elk een eigen kleur
  mi:    { bg:"#dcfce7", color:"#166534", border:"#bbf7d0" }, // groen  â€“ Middelheim
  sa:    { bg:"#fce7f3", color:"#9d174d", border:"#fbcfe8" }, // roze   â€“ Sint-Augustinus
  sv:    { bg:"#ede9fe", color:"#5b21b6", border:"#ddd6fe" }, // paars  â€“ Sint-Vincentius
  ca:    { bg:"#fff7ed", color:"#9a3412", border:"#fed7aa" }, // oranje â€“ Cadix
  jp:    { bg:"#cffafe", color:"#155e75", border:"#a5f3fc" }, // cyaan  â€“ Jan Palfijn
  pl:    { bg:"#fefce8", color:"#854d0e", border:"#fef08a" }, // geel   â€“ Plantin
  // Werk
  th:    { bg:"#f0fdf4", color:"#14532d", border:"#bbf7d0" }, // lichtgroen â€“ Thuiswerk
  opl:   { bg:"#f0f9ff", color:"#0c4a6e", border:"#bae6fd" }, // lichtblauw â€“ Opleiding
  vp:    { bg:"#fdf4ff", color:"#6b21a8", border:"#e9d5ff" }, // lila  â€“ Verplaatsing
  syvor: { bg:"#fff1f2", color:"#881337", border:"#fecdd3" }, // zalm  â€“ Syndicale vorming
  soc:   { bg:"#f7fee7", color:"#3f6212", border:"#d9f99d" }, // limoen â€“ Sociaal verlof
  sov:   { bg:"#f7fee7", color:"#3f6212", border:"#d9f99d" }, // limoen â€“ Sociaal overleg
  bh:    { bg:"#fffbeb", color:"#78350f", border:"#fde68a" }, // amber â€“ Boekhoudersdag
  gbh:   { bg:"#fffbeb", color:"#78350f", border:"#fde68a" },
  gso:   { bg:"#fdf2f8", color:"#831843", border:"#f9a8d4" },
};

function getCodeStyle(token) {
  const c = CODE_COLORS[token] || CODE_COLORS[token.toLowerCase()];
  if (c) return `style="background:${c.bg};color:${c.color};border-color:${c.border};"`;
  return "";
}

function renderTags(code) {
  return splitTokens(code).map(t => {
    const def = CODE_MAP[t] || CODE_MAP[t.toLowerCase()];
    const cls = def ? def.cls : (CODE_CLASSES[t] || CODE_CLASSES[t.toLowerCase()] || "norm");
    const label = def ? def.label
      : t === "H"  ? "Hotline"
      : t === "w"  ? "Weekdagwacht"
      : t === "w1" ? "Zaterdagwacht"
      : t === "w2" ? "Zondagwacht"
      : t === "w3" ? "Feestdagwacht"
      : t.toUpperCase();
    // Speciale klassen krijgen eigen CSS, norm-codes krijgen inline kleur
    const extraStyle = cls === "norm" ? getCodeStyle(t) : "";
    return `<span class="tag ${cls}" ${extraStyle}>${label}</span>`;
  }).join("");
}

function getTagClass(token) {
  const def = CODE_MAP[token] || CODE_MAP[token.toLowerCase()];
  if (def) return def.cls;
  // Fallback: check CODE_CLASSES direct
  return CODE_CLASSES[token] || CODE_CLASSES[token.toLowerCase()] || "norm";
}

function personInitials(name) {
  return name.split(" ").slice(0,2).map(w=>w[0]).join("").toUpperCase();
}

function avatarColor(name) {
  const colors = ["#1a4ecc","#0d7c70","#b45309","#9333ea","#0891b2","#be123c","#166534"];
  let h = 0;
  for(let i=0;i<name.length;i++) h = (h*31 + name.charCodeAt(i)) % colors.length;
  return colors[h];
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOAD DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setStatus(text, kind) {
  const pill = document.getElementById("statusPill");
  const span = document.getElementById("statusText");
  pill.className = "status-pill " + (kind||"");
  span.textContent = text;
}

function renderSkeleton() {
  // Stats skeleton
  const statsRow = document.getElementById("statsRow");
  if (statsRow) {
    statsRow.innerHTML = Array(5).fill(0).map((_, i) => `
      <div class="skeleton-stat">
        <div class="skeleton-line" style="height:9px;width:60%;margin-bottom:8px;animation-delay:${i*0.1}s"></div>
        <div class="skeleton-line" style="height:28px;width:40%;animation-delay:${i*0.1}s"></div>
      </div>`).join("");
  }
  // Cards skeleton
  const grid = document.getElementById("teamGrid");
  if (grid) {
    grid.innerHTML = `<div class="skeleton-grid" style="grid-column:1/-1;">` +
      Array(10).fill(0).map((_, i) => `
        <div class="skeleton-card" style="animation-delay:${i*0.05}s">
          <div style="display:flex;align-items:center;gap:9px;margin-bottom:10px;">
            <div class="skeleton-avatar" style="animation-delay:${i*0.05}s"></div>
            <div class="skeleton-line" style="height:13px;width:70%;animation-delay:${i*0.05}s"></div>
          </div>
          <div class="skeleton-line" style="height:28px;width:85%;animation-delay:${i*0.05+0.1}s;border-radius:8px;"></div>
          <div class="skeleton-line" style="height:10px;width:55%;margin-top:6px;animation-delay:${i*0.05+0.15}s;"></div>
        </div>`).join("") +
    `</div>`;
  }
}

async function loadData() {
  console.log("[Permanenties] loadData() gestart, URL:", DATA_URL);
  setStatus("Ladenâ€¦","load");
  renderSkeleton();
  try {
    const res = await fetch(`${DATA_URL}?v=${Date.now()}`, {cache:"no-store"});
    console.log("[Permanenties] fetch status:", res.status, res.ok);
    if (!res.ok) throw new Error(`HTTP ${res.status} - Bestand niet gevonden: ${DATA_URL}`);
    let raw = await res.json();

    // Normaliseer alle mogelijke Power Automate wrapper-formaten
    // Formaat 1: { stdout: "..." }  (oud formaat)
    if (raw && typeof raw.stdout === "string") raw = JSON.parse(raw.stdout);
    // Formaat 2: { result: "..." }
    else if (raw && typeof raw.result === "string") raw = JSON.parse(raw.result);
    // Formaat 3: dubbel geÃ«ncoded string
    if (typeof raw === "string") raw = JSON.parse(raw);
    // Formaat 4: { returncode, stdout } (shell output wrapper)
    if (raw && typeof raw.stdout === "string") raw = JSON.parse(raw.stdout);

    payload = raw;
    records = (payload.records || []).filter(r =>
      r.person && r.person.toLowerCase() !== "legende"
    );

    // Bouw CODE_MAP vanuit de legende in de JSON
    CODE_MAP = buildCodeMapFromLegend(payload.legend || []);

    allPeople = [...new Set(records.map(r=>r.person))].sort((a,b)=>a.localeCompare(b,"nl"));

    if (payload.generatedAt) {
      const d = new Date(payload.generatedAt);
      document.getElementById("genAt").textContent =
        `Bijgewerkt: ${d.toLocaleDateString("nl-BE")} ${d.toLocaleTimeString("nl-BE",{hour:"2-digit",minute:"2-digit"})}`;
    }

    setStatus("Gesynchroniseerd","ok");
    buildPeopleList();
    buildMonthTabs();
    renderAll();
  } catch(e) {
    console.error("[Permanenties] FOUT:", e);
    setStatus("âš  " + e.message, "err");
    // Toon fout in actieve view
    const errHtml = `<div class="empty-state"><div class="icon">âŒ</div><p style="color:#e84040;">Fout bij laden: ${e.message}</p><p style="font-size:12px;color:var(--sub);margin-top:8px;">Controleer of permanentie.json bereikbaar is.</p></div>`;
    const teamGrid = document.getElementById("teamGrid");
    if (teamGrid) teamGrid.innerHTML = errHtml;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIDEBAR â€“ PEOPLE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPeopleList() {
  const wrap = document.getElementById("peopleList");
  wrap.innerHTML = `
    <div class="person-chip ${filterPerson===''?'active':''}" data-person="">
      <div class="avatar" style="background:rgba(255,255,255,.15)">ğŸ‘¥</div>
      <span>Iedereen</span>
    </div>
  ` + allPeople.map(p => `
    <div class="person-chip ${filterPerson===p?'active':''}" data-person="${p}">
      <div class="avatar" style="background:${avatarColor(p)}">${personInitials(p)}</div>
      <span>${p}</span>
    </div>
  `).join("");

  wrap.querySelectorAll(".person-chip").forEach(el => {
    el.addEventListener("click", () => {
      filterPerson = el.dataset.person;
      wrap.querySelectorAll(".person-chip").forEach(c=>c.classList.remove("active"));
      el.classList.add("active");
      renderAll();
    });
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LEGEND ROW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildLegend() {
  const items = [
    {cls:"hotline", label:"H = Hotline"},
    {cls:"wacht",   label:"W/W1/W2 = Wachtdienst"},
    {cls:"afwezig", label:"V/ADV/Z = Afwezig"},
    {cls:"norm",    label:"Mi/Sa/Th = Aanwezig"},
  ];
  return items.map(i =>
    `<div class="legend-item"><span class="tag ${i.cls}" style="font-family:var(--sans);font-weight:600;">${i.label}</span></div>`
  ).join("");
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildStats(dateStr) {
  const day = records.filter(r => r.date === dateStr);
  const total    = allPeople.length;
  const aanwezig = day.filter(r => !splitTokens(r.code).every(t => ["afwezig"].includes(getTagClass(t)))).length;
  const hotline  = day.filter(r => splitTokens(r.code).includes("H")).length;
  const wacht    = day.filter(r => splitTokens(r.code).some(t => ["w","w1","w2","w3"].includes(t.toLowerCase()))).length;
  const afwezig  = day.filter(r => splitTokens(r.code).every(t => getTagClass(t)==="afwezig")).length;

  const items = [
    { label: "Totaal team", value: total,    accent: "accent-sub",                              delay: ".0s"  },
    { label: "Aanwezig",    value: aanwezig, accent: "accent-green",                             delay: ".05s" },
    { label: "Hotline",     value: hotline,  accent: "accent-red",                              delay: ".1s"  },
    { label: "Wachtdienst", value: wacht,    accent: "accent-amber",                           delay: ".15s" },
    { label: "Afwezig",     value: afwezig,  accent: "accent-sub",        delay: ".2s"  },
  ];
  return items.map(it => `
    <div class="stat-card ${it.accent}" style="animation-delay:${it.delay}">
      <div class="stat-label">${it.label}</div>
      <div class="stat-value">${it.value}</div>
    </div>`).join("");
}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MORGEN STRIP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â”€â”€ CONFETTI â”€â”€
function launchConfetti() {
  const colors = ["#3b5bdb","#748ffc","#f59f00","#2f9e44","#e03131","#ae3ec9","#0c8599","#fff"];
  const count = 80;
  for (let i = 0; i < count; i++) {
    const el = document.createElement("div");
    el.className = "confetti-piece";
    el.style.left = Math.random() * 100 + "vw";
    el.style.width = (8 + Math.random() * 8) + "px";
    el.style.height = (8 + Math.random() * 8) + "px";
    el.style.background = colors[Math.floor(Math.random() * colors.length)];
    el.style.borderRadius = Math.random() > .5 ? "50%" : "2px";
    el.style.animationDuration = (2 + Math.random() * 2) + "s";
    el.style.animationDelay = (Math.random() * 1.5) + "s";
    document.body.appendChild(el);
    el.addEventListener("animationend", () => el.remove());
  }
}

let lastConfettiDate = null;

function checkTeamComplete(dateStr) {
  const banner = document.getElementById("teamCompleteBanner");
  if (!banner) return;
  const dayRecords = records.filter(r => r.date === dateStr);
  const aanwezig = dayRecords.filter(r =>
    !splitTokens(r.code).every(t => getTagClass(t) === "afwezig")
  );
  if (aanwezig.length === allPeople.length && allPeople.length > 0) {
    banner.innerHTML = `<div class="team-complete-banner" id="teamCompleteBannerInner">ğŸ‰ Team Complete! &nbsp;Â·&nbsp; Iedereen aanwezig! ğŸŠ</div>`;
    // Stop eventueel lopend interval eerst
    if (window._gradInterval) { clearInterval(window._gradInterval); window._gradInterval = null; }
    const gradColors = ["#3b5bdb","#748ffc","#2f9e44","#f59f00","#e03131"];
    let gradIdx = 0;
    const gradEl = document.getElementById("teamCompleteBannerInner");
    window._gradInterval = setInterval(() => {
      gradIdx = (gradIdx + 1) % gradColors.length;
      if (gradEl) { gradEl.style.background = gradColors[gradIdx]; gradEl.style.transition = "background 0.4s ease"; }
    }, 500);
    setTimeout(() => {
      clearInterval(window._gradInterval);
      window._gradInterval = null;
      if (gradEl) { gradEl.style.transition = "background 1s ease"; gradEl.style.background = "#3b5bdb"; }
    }, 5000);
    // Confetti enkel 1x per dag tonen
    if (lastConfettiDate !== dateStr) {
      lastConfettiDate = dateStr;
      launchConfetti();
    }
  } else {
    banner.innerHTML = "";
  }
}

// â”€â”€ TOPBAR MELDINGEN â”€â”€
function updateTopbarNotice(dateStr) {
  const el = document.getElementById("topbarNoticeText");
  if (!el) return;

  const msgs = [];

  // Team complete?
  const dayRecords = records.filter(r => r.date === dateStr);
  const aanwezig = dayRecords.filter(r =>
    !splitTokens(r.code).every(t => getTagClass(t) === "afwezig")
  );
  if (aanwezig.length === allPeople.length && allPeople.length > 0) {
    msgs.push("ğŸ‰ Team Complete!");
  }

  // Vrijdag?
  const dateObj = new Date(...dateStr.split("-").map((v,i) => i===1 ? Number(v)-1 : Number(v)));
  if (dateObj.getDay() === 5) msgs.push("âœ¨ It's Friyay! Have a great weekend! âœ¨");

  el.textContent = msgs.join("  Â·  ");
}

function buildMorgenStrip(dateStr) {
  const wrap = document.getElementById("morgenStrip");
  if (!wrap) return;

  // Bereken volgende werkdag (sla weekend over)
  const [y,m,d] = dateStr.split("-").map(Number);
  const volgende = new Date(y, m-1, d);
  volgende.setDate(volgende.getDate() + 1);
  while (volgende.getDay() === 0 || volgende.getDay() === 6) {
    volgende.setDate(volgende.getDate() + 1);
  }
  const volgIso   = isoFromDate(volgende);
  const isMoregen = volgende.getDate() === new Date(y,m-1,d+1).getDate()
                    && volgende.getMonth() === new Date(y,m-1,d+1).getMonth();
  const dagNaam   = isMoregen
    ? "morgen"
    : `${DAYS_NL[volgende.getDay()]} ${volgende.getDate()} ${MONTHS_NL[volgende.getMonth()]}`;

  const volgRecords = records.filter(r => r.date === volgIso);
  const hotline = volgRecords.find(r => splitTokens(r.code).includes("H"));
  const wacht   = volgRecords.find(r => splitTokens(r.code).some(t => ["w","w1","w2","w3"].includes(t.toLowerCase())));

  if (!hotline && !wacht) { wrap.innerHTML = ""; return; }

  let items = `<span class="morgen-strip-label">Volgende werkdag (${dagNaam}):</span>`;

  if (hotline) {
    items += `<span class="morgen-item">
      <span class="tag hotline" style="font-size:10px;padding:2px 7px;">Hotline</span>
      <strong>${hotline.person}</strong>
    </span>`;
  }
  if (wacht) {
    items += `<span class="morgen-item" style="color:var(--sub);">Â·</span>
    <span class="morgen-item">
      <span class="tag wacht" style="font-size:10px;padding:2px 7px;">Wacht</span>
      <strong>${wacht.person}</strong>
    </span>`;
  }

  wrap.innerHTML = items;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TODAY VIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderToday() {
  const dateStr = document.getElementById("datePicker").value || isoToday();
  const q = "";

  const dateObj = new Date(...dateStr.split("-").map((v,i) => i===1 ? Number(v)-1 : Number(v)));
  const isVrijdag = dateObj.getDay() === 5;
  document.getElementById("todayTitle").innerHTML =
    `Permanenties â€” <span>${formatDateNL(dateStr)}</span>${isVrijdag ? ' <span style="font-size:18px;">ğŸ‰</span>' : ''}`;
  document.getElementById("todaySub").textContent = "";
  document.getElementById("legendRow").innerHTML = buildLegend();
  document.getElementById("statsRow").innerHTML  = buildStats(dateStr);
  buildMorgenStrip(dateStr);
  checkTeamComplete(dateStr);
  updateTopbarNotice(dateStr);

  // Vrijdag easter egg â€” confetti bij eerste load op vrijdag
  if (isVrijdag && !window._vrijdagConfetti) {
    window._vrijdagConfetti = true;
    setTimeout(() => {
      // Friyay overlay tekst
      const overlay = document.createElement("div");
      overlay.className = "friyay-overlay";
      overlay.innerHTML = `<div style="text-align:center;">
        <div class="friyay-text">âœ¨ It's Friyay! âœ¨</div>
        <div style="font-size:clamp(18px,3.5vw,36px); font-weight:700; color:rgba(255,255,255,.9); margin-top:8px; text-shadow: 0 2px 12px rgba(0,0,0,.3);">Have a great weekend! ğŸŠ</div>
      </div>`;
      document.body.appendChild(overlay);
      setTimeout(() => overlay.remove(), 3500);

      const colors = ["#f59f00","#ffd43b","#ffe066","#fab005","#fd7e14","#ffec99"];
      for (let i = 0; i < 80; i++) {
        const el = document.createElement("div");
        el.className = "confetti-piece";
        el.style.left = Math.random() * 100 + "vw";
        el.style.width = el.style.height = (6 + Math.random() * 6) + "px";
        el.style.background = colors[Math.floor(Math.random() * colors.length)];
        el.style.borderRadius = Math.random() > .5 ? "50%" : "2px";
        el.style.animationDuration = (2.5 + Math.random() * 2) + "s";
        el.style.animationDelay = (Math.random() * 2) + "s";
        document.body.appendChild(el);
        el.addEventListener("animationend", () => el.remove());
      }
    }, 500);
  }

  // Bouw kaarten
  const todayRecords = records.filter(r => r.date === dateStr);
  let people = filterPerson ? [filterPerson] : allPeople;
  const cards = [];
  for (const person of people) {
    const row = todayRecords.find(r => r.person === person);
    const code = row ? row.code : null;
    const tokens = code ? splitTokens(code) : [];

    // Code-filter: exacte token match OF code bevat de filterwaarde (case-insensitive)
    if (filterCode) {
      const codeMatch = tokens.some(t => t.toLowerCase() === filterCode.toLowerCase());
      if (!codeMatch) continue;
    }

    if (q) {
      const hay = `${person} ${code||""}`.toLowerCase();
      if (!hay.includes(q)) continue;
    }

    let grpCls = "grp-geen"; let sortKey = "9_geen";
    // Middelheim krijgt prioriteit highlight (maar hotline gaat voor)
    const hasMiddelheim = tokens.some(t => t.toLowerCase() === "mi");
    for (const t of tokens) {
      const cls = (CODE_MAP[t]||{}).cls || CODE_CLASSES[t] || "norm";
      if (cls === "hotline") { grpCls = "grp-hotline"; sortKey = "1_hotline"; break; }
      if (cls === "wacht")   { grpCls = "grp-wacht";   sortKey = "2_wacht";   break; }
      if (hasMiddelheim)     { grpCls = "grp-middelheim"; sortKey = "2_middelheim"; break; }
      if (cls === "norm")    { grpCls = "grp-norm";     sortKey = "3_" + t;   break; }
      if (cls === "afwezig") { grpCls = "grp-afwezig";  sortKey = "8_afwezig"; break; }
    }
    if (!code) { grpCls = "grp-geen"; sortKey = "9_geen"; }
    cards.push({ person, code, grpCls, sortKey });
  }

  cards.sort((a, b) => a.sortKey.localeCompare(b.sortKey) || a.person.localeCompare(b.person, "nl"));

  const grid = document.getElementById("teamGrid");
  if (!cards.length) {
    grid.innerHTML = `<div class="empty-state"><div class="icon">ğŸ”</div><p>Geen resultaten${filterCode ? ` voor code <b>${filterCode}</b>` : ""}.</p></div>`;
    return;
  }

  grid.innerHTML = cards.map((card, i) => {
    const tags = card.code ? renderTags(card.code) : `<span class="tag empty">Geen data</span>`;
    return `<div class="team-card ${card.grpCls}" style="animation-delay:${i*0.04}s">
      <div class="tc-top">
        <div class="tc-avatar" style="background:${avatarColor(card.person)}">${personInitials(card.person)}</div>
        <div class="tc-name">${card.person}</div>
      </div>
      <div class="tc-codes">${tags}</div>
    </div>`;
  }).join("");
}



// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// WEEK VIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderWeek() {
  if (!currentWeekStart) {
    currentWeekStart = getMonday(document.getElementById("datePicker").value || isoToday());
  }

  const days = Array.from({length:5}, (_,i) => isoFromDate(addDays(currentWeekStart, i)));
  const todayIso = isoToday();

  const startDate = new Date(...days[0].split("-").map((v,i)=>i===1?Number(v)-1:Number(v)));
  const endDate   = new Date(...days[4].split("-").map((v,i)=>i===1?Number(v)-1:Number(v)));
  document.getElementById("weekLabel").textContent =
    `Week van ${startDate.getDate()} ${MONTHS_NL[startDate.getMonth()]} â€” ${endDate.getDate()} ${MONTHS_NL[endDate.getMonth()]} ${endDate.getFullYear()}`;

  let people = filterPerson ? [filterPerson] : allPeople;
  const q = "";
  if (q) people = people.filter(p => p.toLowerCase().includes(q));
  // Code filter: behoud alleen mensen die deze week de code hebben
  if (filterCode) {
    const days = Array.from({length:5}, (_,i) => isoFromDate(addDays(currentWeekStart, i)));
    people = people.filter(p => days.some(d => {
      const r = records.find(rr => rr.date === d && rr.person === p);
      return r && splitTokens(r.code).some(t => t.toLowerCase() === filterCode.toLowerCase());
    }));
  }

  const dayNames = days.map(d => {
    const dt = new Date(...d.split("-").map((v,i)=>i===1?Number(v)-1:Number(v)));
    return { iso: d, name: DAYS_NL[dt.getDay()], num: dt.getDate(), isToday: d === todayIso };
  });

  const isMobile = window.innerWidth <= 750;

  if (isMobile) {
    // Mobiele versie: gestapelde dagkaarten
    document.getElementById("weekGridWrap").style.display = "none";
    const mwrap = document.getElementById("weekMobileWrap");
    mwrap.style.display = "block";

    let html = "";
    for (const day of dayNames) {
      const isToday = day.iso === todayIso;
      const dayRecords = people.map(person => {
        const row = records.find(r => r.date === day.iso && r.person === person);
        return row ? { person, code: row.code } : null;
      }).filter(Boolean);

      html += `<div style="margin-bottom:10px; background:#fff; border-radius:12px; border:1.5px solid ${isToday ? 'var(--blue)' : 'var(--lineL)'}; overflow:hidden;">
        <div style="padding:10px 14px; background:${isToday ? 'var(--blue)' : 'var(--navy)'}; display:flex; align-items:center; gap:8px;">
          <span style="font-size:20px; font-weight:800; color:#fff; line-height:1;">${day.num}</span>
          <span style="font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.8px; color:rgba(255,255,255,.65);">${day.name}</span>
          ${isToday ? '<span style="margin-left:auto;font-size:10px;font-weight:700;background:rgba(255,255,255,.2);color:#fff;padding:2px 8px;border-radius:999px;">Vandaag</span>' : ''}
        </div>`;

      if (!dayRecords.length) {
        html += `<div style="padding:10px 14px; color:#94a3b8; font-size:13px; font-style:italic;">Geen data</div>`;
      } else {
        html += `<div style="padding:6px 10px;">`;
        for (const r of dayRecords) {
          html += `<div style="display:flex; align-items:center; gap:8px; padding:6px 4px; border-bottom:1px solid rgba(13,27,42,.05);">
            <span style="width:24px;height:24px;border-radius:7px;background:${avatarColor(r.person)};color:#fff;font-size:9px;font-weight:700;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;">${personInitials(r.person)}</span>
            <span style="font-size:13px;font-weight:700;min-width:70px;">${r.person}</span>
            <span style="display:flex;flex-wrap:wrap;gap:3px;">${renderTags(r.code)}</span>
          </div>`;
        }
        html += `</div>`;
      }
      html += `</div>`;
    }
    mwrap.innerHTML = html;

  } else {
    // Desktop versie: raster
    document.getElementById("weekMobileWrap").style.display = "none";
    document.getElementById("weekGridWrap").style.display = "block";

    let html = `<div class="week-grid">`;
    html += `<div class="wg-header">Medewerker</div>`;
    dayNames.forEach(d => {
      html += `<div class="wg-header day-col${d.isToday?" today-col":""}">
        <span class="day-name">${d.name}</span>
        <span class="day-num">${d.num}</span>
      </div>`;
    });
    people.forEach(person => {
      html += `<div class="wg-person">
        <div class="avatar" style="background:${avatarColor(person)};width:22px;height:22px;font-size:9px;border-radius:6px;flex-shrink:0;">${personInitials(person)}</div>
        ${person}
      </div>`;
      days.forEach((d, di) => {
        const row = records.find(r => r.date === d && r.person === person);
        const tags = row ? renderTags(row.code) : "";
        html += `<div class="wg-cell${dayNames[di].isToday?" today-col":""}">${tags}</div>`;
      });
    });
    html += `</div>`;
    document.getElementById("weekGridWrap").innerHTML = html;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LIST VIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let activeMonth = null;

function buildMonthTabs() {
  const months = [...new Set(records.map(r => r.date.slice(0,7)))].sort();
  const todayMonth = isoToday().slice(0,7);
  if (!activeMonth) activeMonth = months.includes(todayMonth) ? todayMonth : (months[0]||null);

  const wrap = document.getElementById("monthTabs");
  wrap.innerHTML = months.map(m => {
    const [y,mo] = m.split("-");
    return `<div class="month-tab${m===activeMonth?" active":""}" data-month="${m}">
      ${MONTHS_NL[Number(mo)-1].slice(0,3)} ${y}
    </div>`;
  }).join("");

  wrap.querySelectorAll(".month-tab").forEach(el => {
    el.addEventListener("click", () => {
      activeMonth = el.dataset.month;
      wrap.querySelectorAll(".month-tab").forEach(t=>t.classList.remove("active"));
      el.classList.add("active");
      renderList();
    });
  });
}

function renderList() {
  const q = "";
  const wrap = document.getElementById("calendarWrap");

  let filtered = records.slice();
  if (activeMonth) filtered = filtered.filter(r => r.date.startsWith(activeMonth));
  if (filterPerson) filtered = filtered.filter(r => r.person === filterPerson);
  if (filterCode)   filtered = filtered.filter(r => splitTokens(r.code).some(t => t.toLowerCase() === filterCode.toLowerCase()));
  if (q) filtered = filtered.filter(r => {
    const mapped = splitTokens(r.code).map(t => (CODE_MAP[t]||{}).label||t).join(" ");
    return `${r.date} ${r.person} ${r.code} ${mapped}`.toLowerCase().includes(q);
  });

  if (!activeMonth || !filtered.length) {
    wrap.innerHTML = `<div class="empty-state"><div class="icon">ğŸ“­</div><p>Geen data voor deze selectie.</p></div>`;
    return;
  }

  const [yr, mo] = activeMonth.split("-").map(Number);
  const daysInMonth = new Date(yr, mo, 0).getDate();
  const todayIso = isoToday();

  // Groepeer per dag
  const byDay = {};
  for (const r of filtered) {
    const day = Number(r.date.split("-")[2]);
    if (!byDay[day]) byDay[day] = [];
    byDay[day].push(r);
  }

  // Bouw kalender-raster
  let html = `<div class="cal-grid">`;

  for (let d = 1; d <= daysInMonth; d++) {
    const iso = `${yr}-${pad(mo)}-${pad(d)}`;
    const dt = new Date(yr, mo-1, d);
    const dayOfWeek = dt.getDay(); // 0=zo, 6=za
    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
    const isToday = iso === todayIso;
    const dayName = DAYS_NL[dayOfWeek];
    const entries = byDay[d] || [];

    let cls = "cal-day";
    if (isWeekend) cls += " weekend";
    if (isToday) cls += " today";
    if (!entries.length) cls += " empty";

    html += `<div class="${cls}">
      <div class="cal-day-header">
        <span class="cal-day-num">${d}</span>
        <span class="cal-day-name">${dayName}</span>
      </div>
      <div class="cal-entries">`;

    for (const r of entries) {
      const tokens = splitTokens(r.code);
      const chips = renderTags(tokens.join(","));

      html += `<div class="cal-entry">
        <span class="cal-entry-name" style="color:${avatarColor(r.person)}">${r.person}</span>
        <span class="cal-entry-codes">${chips}</span>
      </div>`;
    }

    html += `</div></div>`;
  }

  html += `</div>`;
  wrap.innerHTML = html;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER ALL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAll(skipSkeleton) {
  buildFilterPanel();
  if (activeView === "today") renderToday();
  else if (activeView === "week") renderWeek();
  else if (activeView === "list") renderList();
}

function buildFilterPanel() {
  const panel = document.getElementById("filterPanel");
  if (!panel || panel.style.display === "none") return; // panel is dicht, niet herbouwen
  const dateStr = document.getElementById("datePicker").value || isoToday();
  let relevantRecords = records;
  if (activeView === "today") {
    relevantRecords = records.filter(r => r.date === dateStr);
  } else if (activeView === "week" && currentWeekStart) {
    const days = Array.from({length:5}, (_,i) => isoFromDate(addDays(currentWeekStart, i)));
    relevantRecords = records.filter(r => days.includes(r.date));
  } else if (activeView === "list" && activeMonth) {
    relevantRecords = records.filter(r => r.date.startsWith(activeMonth));
  }
  if (filterPerson) relevantRecords = relevantRecords.filter(r => r.person === filterPerson);

  const codeCount = {};
  for (const r of relevantRecords) {
    for (const t of splitTokens(r.code)) {
      codeCount[t] = (codeCount[t] || 0) + 1;
    }
  }

  const btnsWrap = document.getElementById("filterBtns");
  const clearBtn = document.getElementById("filterClearAll");
  if (!btnsWrap) return;

  btnsWrap.innerHTML = Object.entries(codeCount).sort().map(([token, count]) => {
    const def = CODE_MAP[token] || {};
    const cls  = def.cls || CODE_CLASSES[token] || "norm";
    const label = def.label || (token === "H" ? "Hotline" : token.toUpperCase());
    const tagStyle = cls === "hotline" ? "background:var(--red);color:#fff;border-color:var(--red);"
      : cls === "wacht"   ? "background:var(--amber2);color:var(--amber);border-color:#ffd43b;"
      : cls === "afwezig" ? "background:var(--bg);color:var(--sub);border-color:var(--line);"
      : (() => { const cs = getCodeStyle(token); return cs ? cs.replace(/style="|"/g,'') : "background:var(--blue5);color:var(--blue);border-color:rgba(59,91,219,.2);"; })();
    const isActive = filterCode === token;
    return `<span class="cf-btn${isActive?' active':''}" data-code="${token}" style="${tagStyle}">${label}<span style="opacity:.55;margin-left:4px;font-weight:500;">${count}</span></span>`;
  }).join("");

  btnsWrap.querySelectorAll(".cf-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      filterCode = filterCode === btn.dataset.code ? "" : btn.dataset.code;
      updateFilterBadge();
      if (clearBtn) clearBtn.style.display = filterCode ? "inline-flex" : "none";
      renderAll();
    });
  });

  if (clearBtn) clearBtn.style.display = filterCode ? "inline-flex" : "none";
  updateFilterBadge();
}

function clearCodeFilter() {
  filterCode = "";
  updateFilterBadge();
  renderAll();
}

function updateFilterBadge() {
  const badge    = document.getElementById("filterBadge");
  const btn      = document.getElementById("btnFilter");
  const mobDot   = document.getElementById("mobFilterDot");
  const mobBtn   = document.getElementById("mobFilterBtn");
  if (badge)  { badge.style.display = filterCode ? "inline-block" : "none"; badge.textContent = filterCode ? "1" : ""; }
  if (btn)    btn.classList.toggle("active", !!filterCode);
  if (mobDot) mobDot.style.display = filterCode ? "inline" : "none";
  if (mobBtn) mobBtn.style.color = filterCode ? "var(--blue)" : "";
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NAV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll(".nav-item").forEach(el => {
  el.addEventListener("click", () => {
    activeView = el.dataset.view;
    document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
    el.classList.add("active");
    document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
    document.getElementById("view-"+activeView).classList.add("active");
    renderAll();
  });
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TOPBAR CONTROLS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const datePicker = document.getElementById("datePicker");
datePicker.value = isoToday();
function switchView(viewName) {
  activeView = viewName;
  document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("active"));
  document.querySelector(`.nav-item[data-view="${viewName}"]`).classList.add("active");
  document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
  // Re-trigger animatie
  const target = document.getElementById("view-" + viewName);
  target.style.opacity = "0";
  target.classList.remove("active");
  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      target.style.opacity = "";
      target.classList.add("active");
    });
  });
  // Sync mobile nav ook
  document.querySelectorAll(".mob-nav-item[data-mob-view]").forEach(el => {
    el.classList.toggle("active", el.dataset.mobView === viewName);
  });
}

datePicker.addEventListener("change", () => {
  currentWeekStart = getMonday(datePicker.value || isoToday());
  // Datum kiezen heeft alleen zin in Vandaag/Week view â€” stuur door als in Lijst
  if (activeView === "list") switchView("today");
  renderAll();
});



document.getElementById("btnToday").addEventListener("click", () => {
  const realToday = isoToday(); // altijd de echte datum, ongeacht wat in datepicker staat
  datePicker.value = realToday;
  currentWeekStart = getMonday(realToday);
  
  switchView("today");
  renderAll();
});

document.getElementById("btnReset").addEventListener("click", () => {
  datePicker.value = "";
  filterPerson = "";
  filterCode = "";
  updateFilterBadge();
  document.getElementById("filterPanel").style.display = "none";
  
  document.querySelectorAll(".person-chip").forEach(c => c.classList.remove("active"));
  document.querySelector('.person-chip[data-person=""]')?.classList.add("active");
  // Reset maandtab naar huidige maand
  const todayMonth = isoToday().slice(0, 7);
  const months = [...new Set(records.map(r => r.date.slice(0, 7)))].sort();
  activeMonth = months.includes(todayMonth) ? todayMonth : (months[0] || null);
  buildMonthTabs();
  renderAll();
});

// Dag navigatie pijltjes
document.getElementById("btnPrevDay").addEventListener("click", () => {
  const cur = datePicker.value || isoToday();
  const prev = isoFromDate(addDays(cur, -1));
  datePicker.value = prev;
  datePickerMob.value = prev;
  currentWeekStart = getMonday(prev);
  renderAll();
});
document.getElementById("btnNextDay").addEventListener("click", () => {
  const cur = datePicker.value || isoToday();
  const next = isoFromDate(addDays(cur, 1));
  datePicker.value = next;
  datePickerMob.value = next;
  currentWeekStart = getMonday(next);
  renderAll();
});

document.getElementById("btnPrevWeek").addEventListener("click", () => {
  currentWeekStart = isoFromDate(addDays(currentWeekStart, -7));
  renderAll();
});
document.getElementById("btnNextWeek").addEventListener("click", () => {
  currentWeekStart = isoFromDate(addDays(currentWeekStart, 7));
  renderAll();
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MOBILE NAV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function syncMobileNav() {
  document.querySelectorAll(".mob-nav-item[data-mob-view]").forEach(el => {
    el.classList.toggle("active", el.dataset.mobView === activeView);
  });
}

document.querySelectorAll(".mob-nav-item[data-mob-view]").forEach(el => {
  el.addEventListener("click", () => {
    switchView(el.dataset.mobView);
    closeMobPeople();
    syncMobileNav();
    renderAll();
  });
});

// Persoon popup op mobiel
let mobPeopleOpen = false;
function closeMobPeople() {
  mobPeopleOpen = false;
  document.getElementById("mobPeoplePopup").style.display = "none";
}

function closeMobFilter() {
  const panel = document.getElementById("filterPanel");
  if (panel) panel.style.display = "none";
}

// Mobiele filter knop
document.getElementById("mobFilterBtn").addEventListener("click", () => {
  const panel = document.getElementById("filterPanel");
  if (!panel) return;
  const isOpen = panel.style.display !== "none";
  panel.style.display = isOpen ? "none" : "block";
  if (!isOpen) buildFilterPanel();
  // Sluit people popup
  closeMobPeople();
});

document.getElementById("mobPeopleBtn").addEventListener("click", () => {
  mobPeopleOpen = !mobPeopleOpen;
  document.getElementById("mobPeoplePopup").style.display = mobPeopleOpen ? "block" : "none";
  if (mobPeopleOpen) { buildMobPeopleStrip(); closeMobFilter(); }
});

function buildMobPeopleStrip() {
  const strip = document.getElementById("mobPeopleStrip");
  const people = ["", ...allPeople];
  strip.innerHTML = people.map(p => {
    const label = p || "Iedereen";
    const av = p ? `<span class="avatar" style="background:${avatarColor(p)};display:inline-flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:#fff;">${personInitials(p)}</span>` : `<span class="avatar" style="background:rgba(13,27,42,.15);display:inline-flex;align-items:center;justify-content:center;font-size:11px;">ğŸ‘¥</span>`;
    return `<div class="mob-person-btn ${filterPerson===p?'active':''}" data-person="${p}">${av}${label}</div>`;
  }).join("");

  strip.querySelectorAll(".mob-person-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      filterPerson = btn.dataset.person;
      // Sync sidebar ook
      document.querySelectorAll(".person-chip").forEach(c => c.classList.remove("active"));
      document.querySelector(`.person-chip[data-person="${filterPerson}"]`)?.classList.add("active");
      buildMobPeopleStrip();
      closeMobPeople();
      renderAll();
    });
  });
}

// Sluit popup bij klik buiten
document.addEventListener("click", (e) => {
  if (mobPeopleOpen &&
      !document.getElementById("mobPeoplePopup").contains(e.target) &&
      !document.getElementById("mobPeopleBtn").contains(e.target)) {
    closeMobPeople();
  }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// START
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
currentWeekStart = getMonday(isoToday());

// Filter panel toggle
const btnFilterEl = document.getElementById("btnFilter");
if (btnFilterEl) {
  btnFilterEl.addEventListener("click", () => {
    const panel = document.getElementById("filterPanel");
    if (!panel) return;
    const isOpen = panel.style.display !== "none";
    panel.style.display = isOpen ? "none" : "block";
    if (!isOpen) buildFilterPanel();
  });
}

// Mobiele datumkiezer sync
const datePickerMob = document.getElementById("datePickerMob");
datePickerMob.value = isoToday();
datePickerMob.addEventListener("change", () => {
  datePicker.value = datePickerMob.value;
  currentWeekStart = getMonday(datePickerMob.value || isoToday());
  renderAll();
});
// Sync desktop -> mobiel ook
datePicker.addEventListener("change", () => {
  datePickerMob.value = datePicker.value;
});

document.getElementById("btnTodayMob").addEventListener("click", () => {
  const realToday = isoToday();
  datePicker.value = realToday;
  datePickerMob.value = realToday;
  currentWeekStart = getMonday(realToday);
  
  switchView("today");
  renderAll();
});

// Start zodra DOM klaar is â€” werkt ook als DOMContentLoaded al voorbij is
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", loadData);
} else {
  loadData(); // DOM is al klaar
}

</script>
</body>
</html>
